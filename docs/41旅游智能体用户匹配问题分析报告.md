# æ—…æ¸¸æ™ºèƒ½ä½“ç”¨æˆ·åŒ¹é…é—®é¢˜åˆ†ææŠ¥å‘Š

## ğŸ” **é—®é¢˜ç°è±¡**

ç”¨æˆ·åœ¨ä½¿ç”¨æ—…æ¸¸è§„åˆ’åŠŸèƒ½æ—¶ï¼Œç³»ç»Ÿå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š

1. **è¿”å›ä¹±ç å†…å®¹**ï¼šå‰ç«¯æ˜¾ç¤ºç±»ä¼¼ `PKï¿½ï¿½[F.ï¿½Bï¿½%cooragent_app_1754141836/setup_mcp.shuï¿½AKA` çš„äºŒè¿›åˆ¶ä¹±ç 
2. **ç”¨æˆ·æ™ºèƒ½ä½“åŒ¹é…å¤±è´¥**ï¼šæ—¥å¿—æ˜¾ç¤º `æœªæ‰¾åˆ°ç”¨æˆ· travel_user_1754144047797 çš„ä¸“å±æ™ºèƒ½ä½“ï¼Œä½¿ç”¨é»˜è®¤é…ç½®`
3. **é”™è¯¯çš„å¤„ç†è·¯å¾„**ï¼šæ—…æ¸¸è¯·æ±‚è¢«è¯†åˆ«ä¸ºä»£ç ç”Ÿæˆä»»åŠ¡ï¼Œæœ€ç»ˆç”ŸæˆZIPæ–‡ä»¶è€Œä¸æ˜¯æ—…æ¸¸æ–¹æ¡ˆ

## ğŸ“Š **æ ¹å› åˆ†æ**

### **é—®é¢˜1ï¼šç”¨æˆ·IDä¸åŒ¹é…**

**ç°è±¡**ï¼š
```
å‰ç«¯ç”Ÿæˆï¼štravel_user_1754144047797 (åŠ¨æ€æ—¶é—´æˆ³)
æ™ºèƒ½ä½“å­˜å‚¨ï¼štravel_user æˆ– travel_test (å›ºå®šå­—ç¬¦ä¸²)
ç»“æœï¼šæ— æ³•åŒ¹é… â†’ ä½¿ç”¨é»˜è®¤é…ç½® â†’ è¿›å…¥ä»£ç ç”Ÿæˆæµç¨‹
```

**è¯¦ç»†åˆ†æ**ï¼š
```bash
# å‰ç«¯JavaScriptä»£ç 
user_id: 'travel_user_' + Date.now()  // ç”Ÿæˆ travel_user_1754144047797

# æ™ºèƒ½ä½“é…ç½®æ–‡ä»¶
store/agents/travel_planner.json -> "user_id": "travel_test"
store/agents/travel_planner_xinjiang.json -> "user_id": "travel_user"

# åŒ¹é…é€»è¾‘ï¼ˆåŸå§‹ï¼‰
if agent_data.get("user_id") == user_id:  // ç²¾ç¡®åŒ¹é…å¤±è´¥
```

### **é—®é¢˜2ï¼šä»»åŠ¡è¯†åˆ«å¤±è´¥**

**ç°è±¡**ï¼š
```
è¾“å…¥ï¼š"åŒ—äº¬æœ‰ä»€ä¹ˆå¥½ç©çš„åœ°æ–¹æ¨èï¼Ÿ"
æœŸæœ›ï¼šè¯†åˆ«ä¸ºæ—…æ¸¸ä»»åŠ¡
å®é™…ï¼šè¯†åˆ«ä¸ºä»£ç ç”Ÿæˆä»»åŠ¡
```

**æ£€æµ‹åˆ°çš„é—®é¢˜**ï¼š
- `is_travel_related_task` å‡½æ•°å¯èƒ½å­˜åœ¨é€»è¾‘é—®é¢˜
- æ—¥å¿—æ˜¾ç¤ºæ²¡æœ‰æ­£ç¡®è¾“å‡ºä»»åŠ¡æ£€æµ‹çš„è¯¦ç»†ä¿¡æ¯

### **é—®é¢˜3ï¼šå·¥ä½œæµå†²çª**

**ç°è±¡**ï¼š
```
æ­£ç¡®è·¯å¾„ï¼š_run_travel_planning â†’ TravelCoordinator â†’ æ—…æ¸¸æ–¹æ¡ˆ
é”™è¯¯è·¯å¾„ï¼š_run_travel_planning â†’ run_agent_workflow â†’ cooragent_generator â†’ ZIPæ–‡ä»¶
```

## ğŸ› ï¸ **è§£å†³æ–¹æ¡ˆ**

### **è§£å†³æ–¹æ¡ˆ1ï¼šæ™ºèƒ½ç”¨æˆ·åŒ¹é…ï¼ˆå·²å®ç°ï¼‰**

ä¿®æ”¹ `src/generator/cooragent_generator.py` ä¸­çš„åŒ¹é…é€»è¾‘ï¼š

```python
# æ™ºèƒ½åŒ¹é…ç”¨æˆ·æ™ºèƒ½ä½“
is_match = False
match_reason = ""

# ç²¾ç¡®åŒ¹é…
if file_user_id == user_id:
    is_match = True
    match_reason = "ç²¾ç¡®åŒ¹é…"
# æ—…æ¸¸ç”¨æˆ·æ¨¡ç³ŠåŒ¹é…ï¼štravel_user_123456 åŒ¹é… travel_user
elif user_id.startswith("travel_user_") and file_user_id == "travel_user":
    is_match = True
    match_reason = "æ—…æ¸¸ç”¨æˆ·æ¨¡ç³ŠåŒ¹é…"
# æµ‹è¯•ç”¨æˆ·åŒ¹é…ï¼štravel_user_123456 åŒ¹é… travel_test  
elif user_id.startswith("travel_user_") and file_user_id == "travel_test":
    is_match = True
    match_reason = "æµ‹è¯•ç”¨æˆ·åŒ¹é…"
```

### **è§£å†³æ–¹æ¡ˆ2ï¼šå·¥ä½œæµé‡æ„ï¼ˆå·²å®ç°ï¼‰**

ä¿®æ”¹ `src/api/generator_api.py` ä¸­çš„ `_run_travel_planning` æ–¹æ³•ï¼š

```python
# ç§»é™¤é‡å¤çš„å·¥ä½œæµè°ƒç”¨
# elif command.goto == "planner":
#     # å¤æ‚è§„åˆ’ï¼Œè°ƒç”¨å®Œæ•´å·¥ä½œæµ (åˆ é™¤)
#     async for event_data in run_agent_workflow(...):  (åˆ é™¤)

# ç›´æ¥ä½¿ç”¨TravelCoordinatorç»“æœ
elif command.goto == "planner":
    # å¤æ‚è§„åˆ’ï¼Œç›´æ¥ä½¿ç”¨TravelCoordinatorç”Ÿæˆçš„è¯¦ç»†è®¡åˆ’
    travel_result = command.update.get("travel_result", {})
    # ç”ŸæˆMarkdownæ–‡ä»¶è€Œä¸æ˜¯ZIPæ–‡ä»¶
```

### **è§£å†³æ–¹æ¡ˆ3ï¼šå¢å¼ºæ—¥å¿—è°ƒè¯•ï¼ˆå·²å®ç°ï¼‰**

æ·»åŠ è¯¦ç»†çš„æ™ºèƒ½ä½“åˆ†ææ—¥å¿—ï¼š

```python
logger.info(f"ğŸ“Š [æ™ºèƒ½ä½“åˆ†æ] å®Œæ•´æ™ºèƒ½ä½“åˆ—è¡¨:")
for i, info in enumerate(all_agents_info, 1):
    logger.info(f"   {i}. {info['agent_name']} (ç”¨æˆ·: {info['user_id']}) - {info['description']}")

logger.info(f"ğŸ¯ [æ™ºèƒ½ä½“åˆ†æ] ç›®æ ‡ç”¨æˆ· '{user_id}' çš„æ™ºèƒ½ä½“:")
if user_agents_found:
    for agent_name in user_agents_found:
        logger.info(f"   âœ… {agent_name}")
else:
    logger.info(f"   âŒ æœªæ‰¾åˆ°ä»»ä½•åŒ¹é…çš„æ™ºèƒ½ä½“")
```

## ğŸ“‹ **å½“å‰æ™ºèƒ½ä½“é…ç½®çŠ¶æ€**

### **å­˜åœ¨çš„æ™ºèƒ½ä½“æ–‡ä»¶**ï¼š
```
store/agents/
â”œâ”€â”€ travel_planner.json (user_id: "travel_test")
â”œâ”€â”€ travel_planner_xinjiang.json (user_id: "travel_user")
â”œâ”€â”€ xinjiang_food_recommender.json
â”œâ”€â”€ food_recommender.json
â”œâ”€â”€ extended_travel_planner.json
â”œâ”€â”€ travel_super_agent.json
â”œâ”€â”€ custom_itinerary_designer.json
â””â”€â”€ ... (å…¶ä»–æ™ºèƒ½ä½“)
```

### **åŒ¹é…è§„åˆ™**ï¼š
```
travel_user_1754144047797 â†’ travel_user âœ… (æ¨¡ç³ŠåŒ¹é…)
travel_user_1754144047797 â†’ travel_test âœ… (æµ‹è¯•åŒ¹é…)
travel_user_1754144047797 â†’ travel_user_1754144047797 âœ… (ç²¾ç¡®åŒ¹é…ï¼Œå¦‚æœå­˜åœ¨)
```

## ğŸ§ª **æµ‹è¯•è®¡åˆ’**

### **æµ‹è¯•ç”¨ä¾‹1ï¼šç”¨æˆ·åŒ¹é…**
```bash
curl -X POST http://localhost:8000/api/generate \
  -H "Content-Type: application/json" \
  -d '{"content": "æˆ‘è¦å»æ–°ç–†æ—…æ¸¸28å¤©", "user_id": "travel_user_123456"}'
```

**æœŸæœ›ç»“æœ**ï¼š
- æ—¥å¿—æ˜¾ç¤ºæ‰¾åˆ°åŒ¹é…çš„æ—…æ¸¸æ™ºèƒ½ä½“
- è¿”å›æ—…æ¸¸è§„åˆ’å†…å®¹ï¼ˆMarkdownæ ¼å¼ï¼‰
- ä¸å†å‡ºç°"æœªæ‰¾åˆ°ç”¨æˆ·ä¸“å±æ™ºèƒ½ä½“"è­¦å‘Š

### **æµ‹è¯•ç”¨ä¾‹2ï¼šä»»åŠ¡è¯†åˆ«**
```bash
curl -X POST http://localhost:8000/api/generate \
  -H "Content-Type: application/json" \
  -d '{"content": "åŒ—äº¬æœ‰ä»€ä¹ˆå¥½ç©çš„åœ°æ–¹æ¨èï¼Ÿ", "user_id": "travel_user_789"}'
```

**æœŸæœ›ç»“æœ**ï¼š
- æ—¥å¿—æ˜¾ç¤º"è¯†åˆ«ä¸ºæ—…æ¸¸è§„åˆ’ä»»åŠ¡"
- è°ƒç”¨TravelCoordinator
- è¿”å›æ—…æ¸¸ä¿¡æ¯ï¼ˆMarkdownæ ¼å¼ï¼‰

## ğŸ”§ **åç»­ä¼˜åŒ–å»ºè®®**

### **çŸ­æœŸä¼˜åŒ–**ï¼š
1. å®Œå–„ä»»åŠ¡è¯†åˆ«é€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰æ—…æ¸¸ç›¸å…³æŸ¥è¯¢éƒ½èƒ½æ­£ç¡®è¯†åˆ«
2. å¢åŠ æ›´å¤šæ—…æ¸¸æ™ºèƒ½ä½“é…ç½®ï¼Œæ”¯æŒä¸åŒåœ°åŒºå’Œç±»å‹çš„æ—…æ¸¸è§„åˆ’
3. ä¼˜åŒ–å‰ç«¯æ˜¾ç¤ºï¼Œç¡®ä¿Markdownå†…å®¹æ­£ç¡®æ¸²æŸ“

### **é•¿æœŸä¼˜åŒ–**ï¼š
1. å®ç°æ™ºèƒ½ä½“åŠ¨æ€åˆ›å»ºæœºåˆ¶ï¼Œä¸ºæ¯ä¸ªç”¨æˆ·è‡ªåŠ¨ç”Ÿæˆä¸“å±æ™ºèƒ½ä½“
2. å¢åŠ ç”¨æˆ·åå¥½å­¦ä¹ åŠŸèƒ½ï¼Œæ ¹æ®å†å²æŸ¥è¯¢ä¼˜åŒ–æ¨è
3. é›†æˆçœŸå®çš„æ—…æ¸¸APIï¼ˆèˆªç­ã€é…’åº—ã€æ™¯ç‚¹ä¿¡æ¯ï¼‰

## ğŸ“ˆ **ä¿®å¤è¿›åº¦**

- âœ… **ç”¨æˆ·åŒ¹é…é—®é¢˜**ï¼šå·²å®ç°æ™ºèƒ½åŒ¹é…é€»è¾‘
- âœ… **å·¥ä½œæµå†²çª**ï¼šå·²ç§»é™¤é‡å¤è°ƒç”¨ï¼Œç›´æ¥ä½¿ç”¨TravelCoordinatorç»“æœ
- âœ… **æ—¥å¿—å¢å¼º**ï¼šå·²æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- ğŸ”„ **ä»»åŠ¡è¯†åˆ«**ï¼šæ­£åœ¨è°ƒè¯•å’Œä¼˜åŒ–
- â³ **å‰ç«¯æ˜¾ç¤º**ï¼šå¾…éªŒè¯ä¿®å¤æ•ˆæœ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-08-02 22:22:00  
**ä¿®å¤çŠ¶æ€**: å¤§éƒ¨åˆ†é—®é¢˜å·²è§£å†³ï¼Œæ­£åœ¨éªŒè¯æœ€ç»ˆæ•ˆæœ 