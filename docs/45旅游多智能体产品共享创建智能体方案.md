# æ—…æ¸¸å¤šæ™ºèƒ½ä½“äº§å“å…±äº«åˆ›å»ºæ™ºèƒ½ä½“æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ·±å…¥åˆ†æç°æœ‰Cooragentå¤šæ™ºèƒ½ä½“åˆ›å»ºå’Œä½¿ç”¨æµç¨‹ï¼Œè®¾è®¡ä¸€ä¸ª**æ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“å…±äº«å¤ç”¨æœºåˆ¶**ï¼Œå®ç°æ™ºèƒ½ä½“çš„é«˜æ•ˆåˆ›å»ºã€å…±äº«å’Œå¤ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºç›¸åŒåŠŸèƒ½çš„æ™ºèƒ½ä½“ï¼ŒåŒæ—¶ä¿æŒæŒç»­åˆ›å»ºä¼˜åŒ–çš„èƒ½åŠ›ã€‚

---

## ğŸ” ç°æœ‰å¤šæ™ºèƒ½ä½“æµç¨‹åˆ†æ

### 1. **ç°æœ‰åˆ›å»ºå’Œç®¡ç†æµç¨‹**

#### **æ ¸å¿ƒç»„ä»¶åˆ†æ**
```python
# src/manager/agents.py - ç°æœ‰æ™ºèƒ½ä½“ç®¡ç†æœºåˆ¶
class AgentManager:
    async def _create_agent_by_prebuilt()    # âœ… æ™ºèƒ½ä½“åˆ›å»º
    async def _save_agent()                  # âœ… æ™ºèƒ½ä½“æŒä¹…åŒ– 
    async def _load_agent()                  # âœ… æ™ºèƒ½ä½“åŠ è½½
    async def _load_default_agents()         # âœ… é»˜è®¤å…±äº«æ™ºèƒ½ä½“
    async def _list_agents()                 # âœ… æ™ºèƒ½ä½“åˆ—è¡¨ç®¡ç†
    async def _list_default_agents()         # âœ… å…±äº«æ™ºèƒ½ä½“åˆ—è¡¨
```

#### **ç°æœ‰å…±äº«æœºåˆ¶é›å½¢**
```python
# ç°æœ‰å…±äº«æ™ºèƒ½ä½“æ ‡è¯†æœºåˆ¶
user_id = "share"  # âœ… å·²æœ‰å…±äº«æ ‡è¯†

# é»˜è®¤å…±äº«æ™ºèƒ½ä½“
await self._create_agent_by_prebuilt(
    user_id="share",           # å…±äº«æ ‡è¯†
    name="researcher",         # ç ”ç©¶å‘˜æ™ºèƒ½ä½“
    name="coder",             # ç¼–ç¨‹å‘˜æ™ºèƒ½ä½“  
    name="browser",           # æµè§ˆå™¨æ™ºèƒ½ä½“
    name="reporter"           # æŠ¥å‘Šå‘˜æ™ºèƒ½ä½“
)

# æ™ºèƒ½ä½“åŠ è½½é€»è¾‘
if _agent.user_id == 'share':
    self.available_agents[_agent.agent_name] = _agent  # è‡ªåŠ¨åŠ è½½å…±äº«æ™ºèƒ½ä½“
```

### 2. **ç°æœ‰å­˜å‚¨ç»“æ„**
```
store/
â”œâ”€â”€ agents/          # âœ… æ™ºèƒ½ä½“å®šä¹‰JSONæ–‡ä»¶
â”œâ”€â”€ prompts/         # âœ… æ™ºèƒ½ä½“æç¤ºè¯æ–‡ä»¶
â”œâ”€â”€ tools/           # âœ… å·¥å…·å®šä¹‰
â””â”€â”€ workflows/       # âœ… å·¥ä½œæµç¼“å­˜
```

### 3. **ç°æœ‰æœºåˆ¶ä¼˜åŠ¿ä¸ä¸è¶³**

#### **âœ… ç°æœ‰ä¼˜åŠ¿**
- å®Œæ•´çš„æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸç®¡ç†
- åŸºç¡€çš„å…±äº«æœºåˆ¶ï¼ˆuser_id="share"ï¼‰
- æ ‡å‡†åŒ–çš„å­˜å‚¨å’ŒåŠ è½½æµç¨‹
- é»˜è®¤æ™ºèƒ½ä½“è‡ªåŠ¨åˆ›å»ºæœºåˆ¶

#### **âš ï¸ ç°æœ‰ä¸è¶³**
- **ç¼ºä¹ç›¸ä¼¼åº¦æ£€æµ‹**ï¼šæ— æ³•è¯†åˆ«é‡å¤åŠŸèƒ½çš„æ™ºèƒ½ä½“
- **æ— ä¸“ä¸šåŒ–æ¨¡æ¿**ï¼šæ²¡æœ‰æ—…æ¸¸é¢†åŸŸçš„æ ‡å‡†æ¨¡æ¿
- **ç¼ºå°‘ç‰ˆæœ¬ç®¡ç†**ï¼šæ— æ³•è¿½è¸ªæ™ºèƒ½ä½“æ¼”è¿›å’Œä¼˜åŒ–
- **æ— æ¨èæœºåˆ¶**ï¼šç¼ºä¹åŸºäºä½¿ç”¨æƒ…å†µçš„æ™ºèƒ½ä½“æ¨è

---

## ğŸ—ï¸ æ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“å…±äº«å¤ç”¨æ–¹æ¡ˆ

### 1. **åŸºäºç°æœ‰æœºåˆ¶çš„æ‰©å±•æ¶æ„**

#### **æ•´ä½“æ¶æ„å›¾**
```mermaid
graph TB
    subgraph "ç°æœ‰æœºåˆ¶(å®Œå…¨å¤ç”¨)"
        A[AgentManager._create_agent_by_prebuilt]
        B[AgentManager._save_agent]
        C[AgentManager._load_agent] 
        D[user_id='share'å…±äº«æœºåˆ¶]
    end
    
    subgraph "æ–°å¢æ‰©å±•å±‚"
        E[TravelAgentTemplateManager<br/>æ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿ç®¡ç†]
        F[AgentSimilarityDetector<br/>ç›¸ä¼¼åº¦æ£€æµ‹å™¨]
        G[SharedAgentRepository<br/>å…±äº«æ™ºèƒ½ä½“ä»“åº“]
        H[AgentVersionManager<br/>ç‰ˆæœ¬ç®¡ç†å™¨]
        I[AgentRecommendationEngine<br/>æ¨èå¼•æ“]
    end
    
    subgraph "ç”¨æˆ·äº¤äº’å±‚"
        J[Cç«¯ç”¨æˆ·è¯·æ±‚]
        K[ç³»ç»Ÿç®¡ç†å‘˜]
        L[æ™ºèƒ½ä½“åˆ›å»ºè¯·æ±‚]
    end
    
    J --> E
    K --> E
    L --> F
    F --> G
    E --> A
    G --> C
    H --> B
    I --> G
    
    A --> B
    B --> C
    C --> D
```

### 2. **æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ**

## åŠŸèƒ½1ï¼šæ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿ç®¡ç†å™¨

### **2.1 åŸºäºç°æœ‰æœºåˆ¶çš„æ¨¡æ¿ç®¡ç†**

#### **æŠ€æœ¯å®ç° - å®Œå…¨å¤ç”¨ç°æœ‰åˆ›å»ºæœºåˆ¶**
```python
# æ–°å»ºï¼šsrc/manager/travel_agent_templates.py
from src.manager.agents import AgentManager
from src.llm.agents import AGENT_LLM_MAP
from src.tools import tavily_tool, python_repl_tool, browser_tool

class TravelAgentTemplateManager:
    """æ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿ç®¡ç†å™¨ - åŸºäºç°æœ‰AgentManageræ‰©å±•"""
    
    def __init__(self, agent_manager: AgentManager):
        # âœ… å¤ç”¨ç°æœ‰AgentManagerå®ä¾‹
        self.agent_manager = agent_manager
        
        # ğŸ”„ æ–°å¢ï¼šæ—…æ¸¸ä¸“ä¸šæ¨¡æ¿å®šä¹‰
        self.travel_templates = {
            # === åŸºç¡€æ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿ ===
            "destination_expert": {
                "name": "destination_expert",
                "nick_name": "ç›®çš„åœ°ä¸“å®¶",
                "llm_type": AGENT_LLM_MAP["researcher"],
                "tools": [tavily_tool, browser_tool],
                "prompt_template": "destination_expert",
                "description": "ä¸“ä¸šçš„æ—…æ¸¸ç›®çš„åœ°ä¸“å®¶ï¼Œæ“…é•¿åˆ†æç›®çš„åœ°ç‰¹è‰²ã€æ¨èæ™¯ç‚¹ã€åˆ¶å®šè¡Œç¨‹è·¯çº¿ï¼Œç†Ÿæ‚‰å…¨çƒçƒ­é—¨æ—…æ¸¸åŸå¸‚çš„æ–‡åŒ–ã€äº¤é€šã€ä½å®¿å’Œç¾é£Ÿä¿¡æ¯ã€‚",
                "specialties": ["destination_analysis", "itinerary_planning", "local_culture"],
                "target_regions": ["global"]
            },
            
            "budget_optimizer": {
                "name": "budget_optimizer", 
                "nick_name": "é¢„ç®—ä¼˜åŒ–å¸ˆ",
                "llm_type": AGENT_LLM_MAP["coder"],
                "tools": [python_repl_tool, tavily_tool],
                "prompt_template": "budget_optimizer",
                "description": "ä¸“ä¸šçš„æ—…æ¸¸é¢„ç®—ä¼˜åŒ–ä¸“å®¶ï¼Œç²¾é€šæˆæœ¬åˆ†æã€ä»·æ ¼æ¯”è¾ƒã€çœé’±æ”»ç•¥åˆ¶å®šï¼Œèƒ½å¤Ÿä¸ºä¸åŒé¢„ç®—æ°´å¹³çš„ç”¨æˆ·æä¾›æœ€ä¼˜æ€§ä»·æ¯”çš„æ—…æ¸¸æ–¹æ¡ˆã€‚",
                "specialties": ["budget_analysis", "cost_optimization", "value_comparison"],
                "target_budgets": ["budget", "mid_range", "luxury"]
            },
            
            "family_travel_planner": {
                "name": "family_travel_planner",
                "nick_name": "äº²å­æ—…æ¸¸è§„åˆ’å¸ˆ", 
                "llm_type": AGENT_LLM_MAP["researcher"],
                "tools": [tavily_tool, browser_tool],
                "prompt_template": "family_travel_planner",
                "description": "ä¸“ä¸šçš„äº²å­æ—…æ¸¸è§„åˆ’ä¸“å®¶ï¼Œæ·±åº¦äº†è§£é€‚åˆä¸åŒå¹´é¾„æ®µå„¿ç«¥çš„æ—…æ¸¸æ´»åŠ¨ã€å®‰å…¨æ³¨æ„äº‹é¡¹ã€äº²å­å‹å¥½çš„ä½å®¿å’Œé¤é¥®é€‰æ‹©ã€‚",
                "specialties": ["family_activities", "child_safety", "age_appropriate_planning"],
                "target_audience": ["families_with_children", "multi_generation"]
            },
            
            "cultural_heritage_guide": {
                "name": "cultural_heritage_guide",
                "nick_name": "æ–‡åŒ–é—äº§å‘å¯¼",
                "llm_type": AGENT_LLM_MAP["researcher"],
                "tools": [tavily_tool, browser_tool],
                "prompt_template": "cultural_heritage_guide", 
                "description": "ä¸“ä¸šçš„æ–‡åŒ–é—äº§æ—…æ¸¸ä¸“å®¶ï¼Œç²¾é€šä¸–ç•Œæ–‡åŒ–é—äº§ã€å†å²å¤è¿¹ã€ä¼ ç»Ÿæ–‡åŒ–ä½“éªŒï¼Œèƒ½å¤Ÿæä¾›æ·±åº¦çš„æ–‡åŒ–æ—…æ¸¸è§£è¯»å’Œä½“éªŒå»ºè®®ã€‚",
                "specialties": ["cultural_heritage", "historical_sites", "traditional_experiences"],
                "target_interests": ["culture", "history", "education"]
            },
            
            "adventure_travel_specialist": {
                "name": "adventure_travel_specialist",
                "nick_name": "æ¢é™©æ—…æ¸¸ä¸“å®¶",
                "llm_type": AGENT_LLM_MAP["researcher"],
                "tools": [tavily_tool, browser_tool],
                "prompt_template": "adventure_travel_specialist",
                "description": "ä¸“ä¸šçš„æ¢é™©æ—…æ¸¸ä¸“å®¶ï¼Œç†Ÿæ‚‰æˆ·å¤–è¿åŠ¨ã€æé™ä½“éªŒã€è‡ªç„¶æ¢ç´¢æ´»åŠ¨ï¼Œèƒ½å¤Ÿä¸ºå–œæ¬¢æŒ‘æˆ˜å’Œåˆºæ¿€çš„æ—…è¡Œè€…å®šåˆ¶å†’é™©æ—…ç¨‹ã€‚",
                "specialties": ["outdoor_activities", "extreme_sports", "nature_exploration"],
                "target_activities": ["hiking", "diving", "skiing", "climbing"]
            },
            
            # === ä¸“ä¸šåŒ–æ—…æ¸¸å·¥ä½œæµæ™ºèƒ½ä½“æ¨¡æ¿ ===
            "transportation_planner": {
                "name": "transportation_planner",
                "nick_name": "äº¤é€šè§„åˆ’æ™ºèƒ½ä½“",
                "llm_type": AGENT_LLM_MAP["researcher"],
                "tools": [tavily_tool, python_repl_tool, browser_tool],
                "prompt_template": "transportation_planner",
                "description": "ä¸“ä¸šçš„äº¤é€šè§„åˆ’ä¸“å®¶ï¼Œç²¾é€šèˆªç­ã€ç«è½¦ã€æ±½è½¦ç­‰å„ç§äº¤é€šæ–¹å¼çš„æ—¶åˆ»è¡¨ã€ä»·æ ¼å¯¹æ¯”å’Œè·¯çº¿ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæ ¹æ®è¡Œç¨‹å®‰æ’æœ€ä¼˜äº¤é€šæ–¹æ¡ˆã€‚",
                "specialties": ["flight_booking", "train_scheduling", "route_optimization", "price_comparison"],
                "target_services": ["flights", "trains", "buses", "car_rental", "local_transport"]
            },
            
            "itinerary_designer": {
                "name": "itinerary_designer",
                "nick_name": "è¡Œç¨‹è®¾è®¡æ™ºèƒ½ä½“",
                "llm_type": AGENT_LLM_MAP["researcher"],
                "tools": [tavily_tool, browser_tool, python_repl_tool],
                "prompt_template": "itinerary_designer",
                "description": "ä¸“ä¸šçš„è¡Œç¨‹è®¾è®¡å¸ˆï¼Œæ ¹æ®ç›®çš„åœ°ç‰¹è‰²å’Œç”¨æˆ·åå¥½ï¼Œæ¨èæœ€ä½³æ™¯ç‚¹ã€æ´»åŠ¨å’Œä½“éªŒï¼Œå¹¶æä¾›è¯¦ç»†çš„æ—¥ç¨‹å®‰æ’å’Œå®ç”¨ä¿¡æ¯ã€‚",
                "specialties": ["attraction_recommendation", "activity_planning", "schedule_optimization", "photo_sourcing"],
                "target_features": ["daily_itinerary", "attraction_details", "photo_urls", "timing_optimization"]
            },
            
            "cost_calculator": {
                "name": "cost_calculator", 
                "nick_name": "è´¹ç”¨è®¡ç®—æ™ºèƒ½ä½“",
                "llm_type": AGENT_LLM_MAP["coder"],
                "tools": [python_repl_tool, tavily_tool],
                "prompt_template": "cost_calculator",
                "description": "ä¸“ä¸šçš„æ—…æ¸¸è´¹ç”¨è®¡ç®—ä¸“å®¶ï¼Œç²¾ç¡®ç»Ÿè®¡äº¤é€šã€ä½å®¿ã€é¤é¥®ã€é—¨ç¥¨ç­‰å„é¡¹å¼€æ”¯ï¼Œæä¾›è¯¦ç»†çš„é¢„ç®—åˆ†æå’Œæˆæœ¬ä¼˜åŒ–å»ºè®®ã€‚",
                "specialties": ["expense_tracking", "budget_analysis", "cost_breakdown", "financial_planning"],
                "target_categories": ["transportation", "accommodation", "meals", "attractions", "shopping", "insurance"]
            },
            
            "report_integrator": {
                "name": "report_integrator",
                "nick_name": "ç»“æœæ•´åˆæ™ºèƒ½ä½“", 
                "llm_type": AGENT_LLM_MAP["reporter"],
                "tools": [python_repl_tool, "mcp-doc"],  # ä½¿ç”¨MCP-Docå·¥å…·ç”ŸæˆWordæ–‡æ¡£
                "prompt_template": "report_integrator",
                "description": "ä¸“ä¸šçš„æ—…æ¸¸æŠ¥å‘Šæ•´åˆä¸“å®¶ï¼Œæ±‡æ€»å„æ™ºèƒ½ä½“çš„è§„åˆ’ç»“æœï¼Œç”ŸæˆåŒ…å«æ–‡å­—æè¿°ã€æ•°æ®è¡¨æ ¼ã€æ™¯ç‚¹å›¾ç‰‡çš„å®Œæ•´Wordæ–‡æ¡£æŠ¥å‘Šã€‚",
                "specialties": ["content_integration", "document_generation", "data_visualization", "report_formatting"],
                "target_outputs": ["word_document", "pdf_report", "presentation", "summary_tables"]
            },
            
            "travel_coordinator": {
                "name": "travel_coordinator",
                "nick_name": "æ—…æ¸¸åè°ƒä¸“å®¶",
                "llm_type": AGENT_LLM_MAP["coordinator"], 
                "tools": [tavily_tool, python_repl_tool, browser_tool],
                "prompt_template": "travel_coordinator",
                "description": "æ—…æ¸¸å¤šæ™ºèƒ½ä½“åè°ƒä¸“å®¶ï¼Œç»Ÿç­¹ç®¡ç†äº¤é€šè§„åˆ’ã€è¡Œç¨‹è®¾è®¡ã€è´¹ç”¨è®¡ç®—ç­‰å„ä¸ªæ™ºèƒ½ä½“ï¼Œç¡®ä¿æ•´ä½“æ—…æ¸¸æ–¹æ¡ˆçš„åè°ƒæ€§å’Œå®Œæ•´æ€§ã€‚",
                "specialties": ["agent_coordination", "workflow_management", "quality_assurance", "integration_optimization"],
                "target_workflow": ["multi_agent_orchestration", "result_validation", "conflict_resolution", "final_integration"]
            }
        }
    
    async def create_standard_travel_agents(self) -> Dict[str, bool]:
        """åˆ›å»ºæ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“ - âœ… å®Œå…¨å¤ç”¨ç°æœ‰åˆ›å»ºæœºåˆ¶"""
        
        results = {}
        
        for template_id, template in self.travel_templates.items():
            try:
                # âœ… æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰
                existing_agents = await self.agent_manager._list_default_agents()
                if any(agent.agent_name == template["name"] for agent in existing_agents):
                    results[template_id] = "already_exists"
                    continue
                
                # âœ… å¤ç”¨ç°æœ‰å·¥å…·è·å–æœºåˆ¶
                tools = []
                for tool in template["tools"]:
                    if tool.name in self.agent_manager.available_tools:
                        tools.append(tool)
                
                # âœ… å®Œå…¨å¤ç”¨ç°æœ‰åˆ›å»ºæ–¹æ³•
                await self.agent_manager._create_agent_by_prebuilt(
                    user_id="share",  # ä½¿ç”¨ç°æœ‰å…±äº«æœºåˆ¶
                    name=template["name"],
                    nick_name=template["nick_name"],
                    llm_type=template["llm_type"],
                    tools=tools,
                    prompt=self._get_template_prompt(template["prompt_template"]),
                    description=template["description"]
                )
                
                results[template_id] = True
                logger.info(f"æˆåŠŸåˆ›å»ºæ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“: {template['name']}")
                
            except Exception as e:
                results[template_id] = False
                logger.error(f"åˆ›å»ºæ—…æ¸¸æ™ºèƒ½ä½“å¤±è´¥ {template_id}: {e}")
        
        return results
    
    def _get_template_prompt(self, template_name: str) -> str:
        """è·å–æ—…æ¸¸æ™ºèƒ½ä½“æç¤ºè¯æ¨¡æ¿"""
        # æ—…æ¸¸ä¸“ä¸šåŒ–æç¤ºè¯æ¨¡æ¿
        prompts = {
            "destination_expert": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…æ¸¸ç›®çš„åœ°ä¸“å®¶ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„å…¨çƒæ—…æ¸¸ç»éªŒå’Œæ·±å…¥çš„åœ°ç†æ–‡åŒ–çŸ¥è¯†ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. ç›®çš„åœ°åˆ†æï¼šæ·±å…¥åˆ†ææ—…æ¸¸ç›®çš„åœ°çš„ç‰¹è‰²ã€äº®ç‚¹ã€æœ€ä½³æ—…æ¸¸æ—¶é—´
2. æ™¯ç‚¹æ¨èï¼šæ ¹æ®ç”¨æˆ·åå¥½æ¨èåˆé€‚çš„æ™¯ç‚¹å’Œæ´»åŠ¨
3. è¡Œç¨‹è§„åˆ’ï¼šåˆ¶å®šåˆç†çš„æ¸¸è§ˆè·¯çº¿å’Œæ—¶é—´å®‰æ’
4. æ–‡åŒ–è§£è¯»ï¼šä»‹ç»å½“åœ°æ–‡åŒ–ã€ä¹ ä¿—ã€æ³¨æ„äº‹é¡¹

å·¥ä½œæµç¨‹ï¼š
1. ç†è§£ç”¨æˆ·çš„ç›®çš„åœ°éœ€æ±‚å’Œåå¥½
2. åˆ†æç›®çš„åœ°çš„æ ¸å¿ƒç‰¹è‰²å’Œäº®ç‚¹
3. æ¨èç¬¦åˆç”¨æˆ·å…´è¶£çš„æ™¯ç‚¹å’Œæ´»åŠ¨
4. åˆ¶å®šè¯¦ç»†çš„è¡Œç¨‹å®‰æ’
5. æä¾›å®ç”¨çš„æ—…æ¸¸å»ºè®®å’Œæ³¨æ„äº‹é¡¹

è¯·å§‹ç»ˆä¿æŒä¸“ä¸šã€çƒ­æƒ…çš„æ€åº¦ï¼Œä¸ºç”¨æˆ·æä¾›æœ‰ä»·å€¼çš„ç›®çš„åœ°ä¿¡æ¯å’Œå»ºè®®ã€‚""",

            "budget_optimizer": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…æ¸¸é¢„ç®—ä¼˜åŒ–ä¸“å®¶ï¼Œç²¾é€šæ—…æ¸¸æˆæœ¬åˆ†æå’Œæ€§ä»·æ¯”æœ€å¤§åŒ–ç­–ç•¥ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. é¢„ç®—åˆ†æï¼šåˆ†ææ—…æ¸¸å„é¡¹æˆæœ¬æ„æˆï¼Œåˆ¶å®šåˆç†é¢„ç®—åˆ†é…
2. æˆæœ¬ä¼˜åŒ–ï¼šå¯»æ‰¾çœé’±æœºä¼šï¼Œæ¨èæ€§ä»·æ¯”é«˜çš„é€‰æ‹©
3. ä»·æ ¼æ¯”è¾ƒï¼šå¯¹æ¯”ä¸åŒé€‰é¡¹çš„ä»·æ ¼å’Œæ€§ä»·æ¯”
4. èµ„é‡‘è§„åˆ’ï¼šåˆ¶å®šåˆ†é˜¶æ®µçš„èµ„é‡‘ä½¿ç”¨è®¡åˆ’

å·¥ä½œæµç¨‹ï¼š
1. äº†è§£ç”¨æˆ·çš„é¢„ç®—èŒƒå›´å’Œæ—…æ¸¸éœ€æ±‚
2. åˆ†ææ—…æ¸¸æˆæœ¬æ„æˆï¼ˆäº¤é€šã€ä½å®¿ã€é¤é¥®ã€æ´»åŠ¨ï¼‰
3. å¯»æ‰¾èŠ‚çœæˆæœ¬çš„æœºä¼šå’Œç­–ç•¥
4. æ¨èæ€§ä»·æ¯”æœ€é«˜çš„é€‰æ‹©æ–¹æ¡ˆ
5. åˆ¶å®šè¯¦ç»†çš„é¢„ç®—åˆ†é…å’Œæ‰§è¡Œè®¡åˆ’

è¯·å§‹ç»ˆä»ç”¨æˆ·çš„ç»æµåˆ©ç›Šå‡ºå‘ï¼Œæä¾›å®ç”¨çš„çœé’±å»ºè®®å’Œä¼˜åŒ–æ–¹æ¡ˆã€‚""",

            "family_travel_planner": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„äº²å­æ—…æ¸¸è§„åˆ’å¸ˆï¼Œæ·±å…¥äº†è§£å®¶åº­æ—…æ¸¸çš„ç‰¹æ®Šéœ€æ±‚å’Œæ³¨æ„äº‹é¡¹ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. äº²å­æ´»åŠ¨è§„åˆ’ï¼šæ¨èé€‚åˆä¸åŒå¹´é¾„æ®µå„¿ç«¥çš„æ—…æ¸¸æ´»åŠ¨
2. å®‰å…¨ä¿éšœï¼šæä¾›å„¿ç«¥æ—…æ¸¸å®‰å…¨æ³¨æ„äº‹é¡¹å’Œåº”æ€¥æªæ–½
3. ä¾¿åˆ©è®¾æ–½ï¼šæ¨èäº²å­å‹å¥½çš„ä½å®¿ã€é¤é¥®å’Œäº¤é€šé€‰æ‹©
4. æ•™è‚²ä»·å€¼ï¼šè®¾è®¡å¯“æ•™äºä¹çš„æ—…æ¸¸ä½“éªŒ

å·¥ä½œæµç¨‹ï¼š
1. äº†è§£å®¶åº­æˆå‘˜æ„æˆå’Œå„¿ç«¥å¹´é¾„
2. åˆ†æé€‚åˆçš„æ—…æ¸¸ç›®çš„åœ°å’Œæ´»åŠ¨ç±»å‹
3. è§„åˆ’å„¿ç«¥å‹å¥½çš„è¡Œç¨‹å®‰æ’
4. æä¾›å®‰å…¨æ³¨æ„äº‹é¡¹å’Œä¾¿åˆ©è®¾æ–½ä¿¡æ¯
5. è®¾è®¡æœ‰æ•™è‚²æ„ä¹‰çš„ä½“éªŒæ´»åŠ¨

è¯·å§‹ç»ˆä»¥å„¿ç«¥çš„å®‰å…¨å’Œå¿«ä¹ä¸ºé¦–è¦è€ƒè™‘ï¼Œä¸ºå®¶åº­æä¾›è´´å¿ƒçš„æ—…æ¸¸å»ºè®®ã€‚""",

            "cultural_heritage_guide": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ–‡åŒ–é—äº§æ—…æ¸¸å‘å¯¼ï¼Œå¯¹ä¸–ç•Œæ–‡åŒ–é—äº§å’Œå†å²æ–‡åŒ–æœ‰æ·±å…¥çš„äº†è§£ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. æ–‡åŒ–è§£è¯»ï¼šæ·±å…¥è®²è§£æ–‡åŒ–é—äº§çš„å†å²ä»·å€¼å’Œæ–‡åŒ–å†…æ¶µ
2. é—äº§æ¨èï¼šæ¨èå€¼å¾—å‚è§‚çš„æ–‡åŒ–é—äº§å’Œå†å²å¤è¿¹
3. ä½“éªŒè®¾è®¡ï¼šè®¾è®¡æ·±åº¦çš„æ–‡åŒ–ä½“éªŒæ´»åŠ¨
4. æ–‡åŒ–å°Šé‡ï¼šæŒ‡å¯¼æ¸¸å®¢å¦‚ä½•å°Šé‡å’Œä¿æŠ¤æ–‡åŒ–é—äº§

å·¥ä½œæµç¨‹ï¼š
1. äº†è§£ç”¨æˆ·å¯¹æ–‡åŒ–æ—…æ¸¸çš„å…´è¶£å’ŒçŸ¥è¯†æ°´å¹³
2. æ¨èç¬¦åˆå…´è¶£çš„æ–‡åŒ–é—äº§å’Œå†å²æ™¯ç‚¹
3. æä¾›æ·±åº¦çš„å†å²æ–‡åŒ–èƒŒæ™¯çŸ¥è¯†
4. è®¾è®¡æ²‰æµ¸å¼çš„æ–‡åŒ–ä½“éªŒæ´»åŠ¨
5. æŒ‡å¯¼æ–‡æ˜æ—…æ¸¸å’Œæ–‡åŒ–ä¿æŠ¤æ„è¯†

è¯·å§‹ç»ˆä»¥ä¼ æ‰¿å’Œä¿æŠ¤æ–‡åŒ–ä¸ºä½¿å‘½ï¼Œä¸ºç”¨æˆ·æä¾›æœ‰æ·±åº¦çš„æ–‡åŒ–æ—…æ¸¸ä½“éªŒã€‚""",

            "adventure_travel_specialist": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ¢é™©æ—…æ¸¸ä¸“å®¶ï¼Œç†Ÿæ‚‰å„ç§æˆ·å¤–è¿åŠ¨å’Œæé™ä½“éªŒæ´»åŠ¨ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. æ¢é™©è§„åˆ’ï¼šè®¾è®¡å®‰å…¨è€Œåˆºæ¿€çš„æ¢é™©æ—…æ¸¸çº¿è·¯
2. æ´»åŠ¨æ¨èï¼šæ¨èé€‚åˆçš„æˆ·å¤–è¿åŠ¨å’Œæé™ä½“éªŒ
3. å®‰å…¨æŒ‡å¯¼ï¼šæä¾›è¯¦ç»†çš„å®‰å…¨æªæ–½å’Œè£…å¤‡å»ºè®®
4. æŠ€èƒ½åŸ¹è®­ï¼šæŒ‡å¯¼å¿…è¦çš„æŠ€èƒ½å’Œå‡†å¤‡å·¥ä½œ

å·¥ä½œæµç¨‹ï¼š
1. è¯„ä¼°ç”¨æˆ·çš„ä½“èƒ½æ°´å¹³å’Œæ¢é™©ç»éªŒ
2. æ¨èé€‚åˆçš„æ¢é™©ç›®çš„åœ°å’Œæ´»åŠ¨ç±»å‹
3. åˆ¶å®šè¯¦ç»†çš„å®‰å…¨è®¡åˆ’å’Œåº”æ€¥é¢„æ¡ˆ
4. æä¾›ä¸“ä¸šçš„è£…å¤‡å»ºè®®å’ŒæŠ€èƒ½æŒ‡å¯¼
5. è®¾è®¡å¾ªåºæ¸è¿›çš„æ¢é™©ä½“éªŒ

è¯·å§‹ç»ˆå°†å®‰å…¨æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œä¸ºç”¨æˆ·æä¾›ä¸“ä¸šçš„æ¢é™©æ—…æ¸¸æŒ‡å¯¼ã€‚""",

            # === ä¸“ä¸šåŒ–æ—…æ¸¸å·¥ä½œæµæ™ºèƒ½ä½“æç¤ºè¯ ===
            "transportation_planner": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„äº¤é€šè§„åˆ’ä¸“å®¶ï¼Œç²¾é€šå„ç§äº¤é€šæ–¹å¼çš„æ—¶åˆ»è¡¨ã€ä»·æ ¼åˆ†æå’Œè·¯çº¿ä¼˜åŒ–ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. äº¤é€šæ–¹æ¡ˆè®¾è®¡ï¼šæ ¹æ®è¡Œç¨‹å®‰æ’æœ€ä¼˜çš„äº¤é€šè·¯çº¿å’Œæ—¶é—´
2. ä»·æ ¼æ¯”è¾ƒåˆ†æï¼šå¯¹æ¯”ä¸åŒäº¤é€šå·¥å…·çš„ä»·æ ¼å’Œæ€§ä»·æ¯”
3. æ—¶åˆ»è¡¨è§„åˆ’ï¼šç²¾ç¡®å®‰æ’å‡ºå‘å’Œåˆ°è¾¾æ—¶é—´ï¼Œç¡®ä¿è¡Œç¨‹è¡”æ¥
4. è·¯çº¿ä¼˜åŒ–ï¼šé€‰æ‹©æœ€efficientçš„äº¤é€šè·¯çº¿ï¼Œå‡å°‘ä¸­è½¬å’Œç­‰å¾…æ—¶é—´

å·¥ä½œæµç¨‹ï¼š
1. åˆ†æç”¨æˆ·çš„å‡ºå‘åœ°ã€ç›®çš„åœ°å’Œæ—¶é—´è¦æ±‚
2. æœç´¢å¹¶æ¯”è¾ƒèˆªç­ã€ç«è½¦ã€æ±½è½¦ç­‰äº¤é€šé€‰é¡¹
3. ä¼˜åŒ–äº¤é€šæ—¶é—´å®‰æ’ï¼Œç¡®ä¿ä¸è¡Œç¨‹å®Œç¾è¡”æ¥
4. æä¾›è¯¦ç»†çš„äº¤é€šæ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
   - å…·ä½“çš„å‡ºå‘/åˆ°è¾¾æ—¶é—´
   - äº¤é€šå·¥å…·ä¿¡æ¯ï¼ˆèˆªç­å·ã€è½¦æ¬¡ç­‰ï¼‰
   - ç¥¨ä»·å’Œé¢„è®¢å»ºè®®
   - æ›¿ä»£æ–¹æ¡ˆå’Œå¤‡é€‰é¡¹
5. è€ƒè™‘ç‰¹æ®Šéœ€æ±‚ï¼ˆå¦‚è¡Œæã€é¤é£Ÿã€åº§ä½åå¥½ç­‰ï¼‰

è¾“å‡ºæ ¼å¼ï¼š
- æ¨èäº¤é€šæ–¹æ¡ˆï¼ˆä¸»è¦å’Œå¤‡é€‰ï¼‰
- è¯¦ç»†æ—¶åˆ»è¡¨å’Œä»·æ ¼ä¿¡æ¯
- é¢„è®¢é“¾æ¥å’Œæ³¨æ„äº‹é¡¹
- æ€»äº¤é€šè´¹ç”¨ä¼°ç®—

è¯·å§‹ç»ˆä»¥ç”¨æˆ·çš„ä¾¿åˆ©æ€§å’Œç»æµæ€§ä¸ºä¼˜å…ˆè€ƒè™‘ã€‚""",

            "itinerary_designer": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è¡Œç¨‹è®¾è®¡å¸ˆï¼Œæ“…é•¿æ ¹æ®ç›®çš„åœ°ç‰¹è‰²å’Œç”¨æˆ·åå¥½è®¾è®¡å®Œç¾çš„æ—…æ¸¸è¡Œç¨‹ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. æ™¯ç‚¹æ¨èï¼šåŸºäºç”¨æˆ·åå¥½æ¨èæœ€é€‚åˆçš„æ™¯ç‚¹å’Œæ´»åŠ¨
2. è¡Œç¨‹è®¾è®¡ï¼šåˆ¶å®šè¯¦ç»†çš„æ—¥ç¨‹å®‰æ’å’Œæ¸¸è§ˆè·¯çº¿
3. å®ç”¨ä¿¡æ¯ï¼šæä¾›æ™¯ç‚¹çš„å¼€æ”¾æ—¶é—´ã€é—¨ç¥¨ä»·æ ¼ã€äº¤é€šæŒ‡å—
4. è§†è§‰æ”¯æŒï¼šæŸ¥æ‰¾å¹¶æä¾›æ™¯ç‚¹çš„é«˜è´¨é‡å›¾ç‰‡URL

å·¥ä½œæµç¨‹ï¼š
1. æ·±å…¥äº†è§£ç”¨æˆ·çš„å…´è¶£åå¥½å’Œæ—…æ¸¸é£æ ¼
2. ç ”ç©¶ç›®çš„åœ°çš„çƒ­é—¨æ™¯ç‚¹å’Œéšè—gem
3. åˆ†ææ™¯ç‚¹çš„ç‰¹è‰²ã€äº®ç‚¹å’Œæœ€ä½³æ¸¸è§ˆæ—¶é—´
4. è®¾è®¡åˆç†çš„æ—¥ç¨‹å®‰æ’ï¼Œè€ƒè™‘ï¼š
   - åœ°ç†ä½ç½®çš„åˆç†è§„åˆ’
   - æ¸¸è§ˆæ—¶é—´çš„å……åˆ†å®‰æ’
   - ä¼‘æ¯å’Œç”¨é¤æ—¶é—´
   - å¤©æ°”å’Œå­£èŠ‚å› ç´ 
5. æŸ¥æ‰¾æ¯ä¸ªæ™¯ç‚¹çš„ä»£è¡¨æ€§å›¾ç‰‡
6. æä¾›è¯¦ç»†çš„æ¸¸è§ˆå»ºè®®å’Œæ³¨æ„äº‹é¡¹

è¾“å‡ºæ ¼å¼ï¼š
- æ¯æ—¥è¯¦ç»†è¡Œç¨‹å®‰æ’
- æ™¯ç‚¹ä»‹ç»å’Œæ¨èç†ç”±
- é«˜è´¨é‡æ™¯ç‚¹å›¾ç‰‡URL
- å®ç”¨ä¿¡æ¯ï¼ˆé—¨ç¥¨ã€å¼€æ”¾æ—¶é—´ã€äº¤é€šï¼‰
- æ¸¸è§ˆå»ºè®®å’Œå°è´´å£«

è¯·ç¡®ä¿æ¨èçš„æ™¯ç‚¹å›¾ç‰‡çœŸå®å¯é ï¼Œè¡Œç¨‹å®‰æ’å¼ å¼›æœ‰åº¦ã€‚""",

            "cost_calculator": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…æ¸¸è´¹ç”¨è®¡ç®—ä¸“å®¶ï¼Œç²¾é€šå„é¡¹æ—…æ¸¸å¼€æ”¯çš„ç²¾ç¡®ç»Ÿè®¡å’Œé¢„ç®—åˆ†æã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. è´¹ç”¨ç»Ÿè®¡ï¼šç²¾ç¡®è®¡ç®—äº¤é€šã€ä½å®¿ã€é¤é¥®ã€é—¨ç¥¨ç­‰å„é¡¹èŠ±è´¹
2. é¢„ç®—åˆ†æï¼šæä¾›è¯¦ç»†çš„è´¹ç”¨æ˜ç»†å’Œå æ¯”åˆ†æ
3. æˆæœ¬ä¼˜åŒ–ï¼šè¯†åˆ«èŠ‚çœè´¹ç”¨çš„æœºä¼šå’Œæ›¿ä»£æ–¹æ¡ˆ
4. è´¢åŠ¡è§„åˆ’ï¼šåˆ¶å®šåˆç†çš„æ—…æ¸¸é¢„ç®—å’Œæ”¯å‡ºè®¡åˆ’

å·¥ä½œæµç¨‹ï¼š
1. æ”¶é›†æ‰€æœ‰æ—…æ¸¸ç›¸å…³çš„è´¹ç”¨ä¿¡æ¯
2. åˆ†ç±»æ•´ç†å„é¡¹å¼€æ”¯ï¼š
   - äº¤é€šè´¹ç”¨ï¼ˆå¾€è¿”+å½“åœ°äº¤é€šï¼‰
   - ä½å®¿è´¹ç”¨ï¼ˆé…’åº—/æ°‘å®¿ï¼‰
   - é¤é¥®è´¹ç”¨ï¼ˆæ­£é¤+å°é£Ÿ+é¥®å“ï¼‰
   - é—¨ç¥¨è´¹ç”¨ï¼ˆæ™¯ç‚¹+æ´»åŠ¨+ä½“éªŒï¼‰
   - è´­ç‰©è´¹ç”¨ï¼ˆçºªå¿µå“+ç‰¹äº§ï¼‰
   - å…¶ä»–è´¹ç”¨ï¼ˆä¿é™©+ç­¾è¯+å°è´¹ç­‰ï¼‰
3. è®¡ç®—æ€»è´¹ç”¨å’Œäººå‡è´¹ç”¨
4. åˆ†æè´¹ç”¨æ„æˆå’Œå æ¯”
5. æä¾›æˆæœ¬ä¼˜åŒ–å»ºè®®

è¾“å‡ºæ ¼å¼ï¼š
- è¯¦ç»†è´¹ç”¨æ˜ç»†è¡¨
- è´¹ç”¨åˆ†ç±»ç»Ÿè®¡å›¾
- æ€»è´¹ç”¨å’Œäººå‡è´¹ç”¨
- è´¹ç”¨å æ¯”åˆ†æ
- èŠ‚çœè´¹ç”¨çš„å»ºè®®
- é¢„ç®—æ‰§è¡Œå»ºè®®

è¯·ç¡®ä¿è®¡ç®—å‡†ç¡®ï¼Œæä¾›å®ç”¨çš„çœé’±å»ºè®®ã€‚""",

            "report_integrator": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…æ¸¸æŠ¥å‘Šæ•´åˆä¸“å®¶ï¼Œæ“…é•¿å°†å„ç§ä¿¡æ¯æ±‡æ€»æˆå®Œæ•´ã€ç¾è§‚çš„æ–‡æ¡£æŠ¥å‘Šã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. å†…å®¹æ•´åˆï¼šæ±‡æ€»äº¤é€šã€è¡Œç¨‹ã€è´¹ç”¨ç­‰å„æ™ºèƒ½ä½“çš„è¾“å‡ºç»“æœ
2. æ–‡æ¡£ç”Ÿæˆï¼šåˆ›å»ºåŒ…å«æ–‡å­—ã€è¡¨æ ¼ã€å›¾ç‰‡çš„å®Œæ•´Wordæ–‡æ¡£
3. æ ¼å¼ä¼˜åŒ–ï¼šç¡®ä¿æ–‡æ¡£ç»“æ„æ¸…æ™°ã€æ’ç‰ˆç¾è§‚
4. è´¨é‡æ£€æŸ¥ï¼šéªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§

å·¥ä½œæµç¨‹ï¼š
1. æ”¶é›†å„ä¸ªæ™ºèƒ½ä½“çš„è¾“å‡ºç»“æœ
2. æ•´ç†å’ŒéªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§
3. è®¾è®¡æ–‡æ¡£ç»“æ„å’Œç‰ˆå¼ï¼š
   - å°é¢å’Œç›®å½•
   - è¡Œç¨‹æ¦‚è¿°
   - è¯¦ç»†æ—¥ç¨‹å®‰æ’
   - äº¤é€šå®‰æ’è¯¦æƒ…
   - è´¹ç”¨é¢„ç®—æ˜ç»†
   - æ™¯ç‚¹å›¾ç‰‡å±•ç¤º
   - å®ç”¨ä¿¡æ¯å’Œè´´å£«
4. ç”ŸæˆWordæ–‡æ¡£å¹¶ä¿å­˜åˆ°æŒ‡å®šä½ç½®
5. ç¡®ä¿æ–‡æ¡£æ ¼å¼ä¸“ä¸šã€å†…å®¹å®Œæ•´

è¾“å‡ºæ ¼å¼ï¼š
- å®Œæ•´çš„Wordæ–‡æ¡£æ–‡ä»¶
- æ–‡æ¡£ä¿å­˜è·¯å¾„ç¡®è®¤
- å†…å®¹æ‘˜è¦å’Œäº®ç‚¹
- æ–‡æ¡£è´¨é‡æ£€æŸ¥æŠ¥å‘Š

æŠ€æœ¯è¦æ±‚ï¼š
- ä½¿ç”¨MCP-Docå·¥å…·ç”ŸæˆWordæ–‡æ¡£
- æ’å…¥è¡¨æ ¼å’Œå›¾ç‰‡
- è®¾ç½®åˆé€‚çš„å­—ä½“å’Œæ ¼å¼
- ä¿å­˜åˆ°ç”¨æˆ·æŒ‡å®šä½ç½®ï¼ˆå¦‚æ¡Œé¢ï¼‰

è¯·ç¡®ä¿ç”Ÿæˆçš„æ–‡æ¡£ä¸“ä¸šç¾è§‚ï¼Œå†…å®¹å®Œæ•´å‡†ç¡®ã€‚""",

            "travel_coordinator": """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…æ¸¸å¤šæ™ºèƒ½ä½“åè°ƒä¸“å®¶ï¼Œè´Ÿè´£ç»Ÿç­¹ç®¡ç†æ•´ä¸ªæ—…æ¸¸è§„åˆ’å·¥ä½œæµç¨‹ã€‚

æ ¸å¿ƒèŒè´£ï¼š
1. å·¥ä½œæµåè°ƒï¼šç»Ÿç­¹äº¤é€šè§„åˆ’ã€è¡Œç¨‹è®¾è®¡ã€è´¹ç”¨è®¡ç®—ç­‰å„ä¸ªæ™ºèƒ½ä½“
2. è´¨é‡ä¿è¯ï¼šç¡®ä¿å„æ™ºèƒ½ä½“è¾“å‡ºç»“æœçš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
3. å†²çªè§£å†³ï¼šå¤„ç†ä¸åŒæ™ºèƒ½ä½“é—´çš„ä¿¡æ¯å†²çªå’Œæ—¶é—´å†²çª
4. æ•´ä½“ä¼˜åŒ–ï¼šä»å…¨å±€è§’åº¦ä¼˜åŒ–æ•´ä¸ªæ—…æ¸¸æ–¹æ¡ˆ

å·¥ä½œæµç¨‹ï¼š
1. åˆ†æç”¨æˆ·çš„æ—…æ¸¸éœ€æ±‚å’Œçº¦æŸæ¡ä»¶
2. åˆ¶å®šæ™ºèƒ½ä½“åä½œç­–ç•¥å’Œæ‰§è¡Œé¡ºåºï¼š
   - é¦–å…ˆè¿›è¡Œè¡Œç¨‹è®¾è®¡ï¼ˆç¡®å®šæ™¯ç‚¹å’Œæ´»åŠ¨ï¼‰
   - ç„¶åå®‰æ’äº¤é€šè§„åˆ’ï¼ˆåŸºäºè¡Œç¨‹å®‰æ’äº¤é€šï¼‰
   - æ¥ç€è®¡ç®—è´¹ç”¨é¢„ç®—ï¼ˆæ±‡æ€»æ‰€æœ‰å¼€æ”¯ï¼‰
   - æœ€åæ•´åˆç”ŸæˆæŠ¥å‘Šï¼ˆæ±‡æ€»æ‰€æœ‰ç»“æœï¼‰
3. ç›‘æ§å„æ™ºèƒ½ä½“çš„æ‰§è¡Œè¿›åº¦å’Œè´¨é‡
4. å¤„ç†æ™ºèƒ½ä½“é—´çš„ä¿¡æ¯ä¼ é€’å’Œä¾èµ–å…³ç³»
5. è¿›è¡Œæœ€ç»ˆçš„è´¨é‡æ£€æŸ¥å’Œæ–¹æ¡ˆä¼˜åŒ–

åè°ƒè§„åˆ™ï¼š
- ç¡®ä¿è¡Œç¨‹å’Œäº¤é€šæ—¶é—´çš„å®Œç¾è¡”æ¥
- éªŒè¯è´¹ç”¨è®¡ç®—çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
- ä¿è¯æœ€ç»ˆæŠ¥å‘ŠåŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- å¤„ç†å¼‚å¸¸æƒ…å†µå’Œå¤‡é€‰æ–¹æ¡ˆ

è¾“å‡ºç®¡ç†ï¼š
- å„é˜¶æ®µæ‰§è¡ŒçŠ¶æ€æŠ¥å‘Š
- æ™ºèƒ½ä½“åä½œç»“æœæ±‡æ€»
- æœ€ç»ˆæ–¹æ¡ˆè´¨é‡è¯„ä¼°
- ç”¨æˆ·æ»¡æ„åº¦æ£€æŸ¥æ¸…å•

è¯·ç¡®ä¿æ•´ä¸ªå·¥ä½œæµç¨‹é«˜æ•ˆæœ‰åºï¼Œæœ€ç»ˆè¾“å‡ºæ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚"""
        }
        
        return prompts.get(template_name, "ä¸“ä¸šçš„æ—…æ¸¸æ™ºèƒ½ä½“ï¼Œä¸ºç”¨æˆ·æä¾›ä¼˜è´¨çš„æ—…æ¸¸æœåŠ¡ã€‚")

    async def get_recommended_agent(self, travel_intent: Dict[str, str]) -> Optional[str]:
        """æ ¹æ®æ—…æ¸¸æ„å›¾æ¨èæœ€ä½³æ™ºèƒ½ä½“"""
        
        # æ„å›¾åŒ¹é…é€»è¾‘
        travel_type = travel_intent.get("travel_type", "general")
        budget_level = travel_intent.get("budget_level", "mid_range") 
        complexity = travel_intent.get("complexity", "simple")
        
        # æ¨èé€»è¾‘
        if travel_type == "cultural_tourism":
            return "cultural_heritage_guide"
        elif travel_type == "family_tourism": 
            return "family_travel_planner"
        elif travel_type == "adventure_tourism":
            return "adventure_travel_specialist"
        elif budget_level in ["budget", "luxury"]:
            return "budget_optimizer"
        elif complexity == "complex":
            return "destination_expert"
        else:
            return "destination_expert"  # é»˜è®¤æ¨è
```

## åŠŸèƒ½2ï¼šæ™ºèƒ½ä½“ç›¸ä¼¼åº¦æ£€æµ‹å’Œå¤ç”¨æœºåˆ¶

### **2.2 åŸºäºç°æœ‰æ•°æ®ç»“æ„çš„ç›¸ä¼¼åº¦æ£€æµ‹**

#### **æŠ€æœ¯å®ç° - åˆ©ç”¨ç°æœ‰Agentæ•°æ®ç»“æ„**
```python
# æ–°å»ºï¼šsrc/manager/agent_similarity.py
from src.interface.agent import Agent
from typing import List, Dict, Tuple
import json
from difflib import SequenceMatcher

class AgentSimilarityDetector:
    """æ™ºèƒ½ä½“ç›¸ä¼¼åº¦æ£€æµ‹å™¨ - åŸºäºç°æœ‰Agentæ•°æ®ç»“æ„"""
    
    def __init__(self, agent_manager: AgentManager):
        # âœ… å¤ç”¨ç°æœ‰AgentManager
        self.agent_manager = agent_manager
        self.similarity_threshold = 0.85  # ç›¸ä¼¼åº¦é˜ˆå€¼
    
    async def find_similar_agents(self, agent_request: Dict[str, Any]) -> List[Tuple[Agent, float]]:
        """æŸ¥æ‰¾ç›¸ä¼¼çš„å·²æœ‰æ™ºèƒ½ä½“ - âœ… åŸºäºç°æœ‰æ™ºèƒ½ä½“æ•°æ®"""
        
        # è·å–æ‰€æœ‰å¯ç”¨æ™ºèƒ½ä½“ - âœ… å¤ç”¨ç°æœ‰æ–¹æ³•
        all_agents = await self.agent_manager._list_agents()
        similar_agents = []
        
        for existing_agent in all_agents:
            similarity_score = self._calculate_similarity(agent_request, existing_agent)
            
            if similarity_score >= self.similarity_threshold:
                similar_agents.append((existing_agent, similarity_score))
        
        # æŒ‰ç›¸ä¼¼åº¦æ’åº
        similar_agents.sort(key=lambda x: x[1], reverse=True)
        return similar_agents
    
    def _calculate_similarity(self, request: Dict[str, Any], existing_agent: Agent) -> float:
        """è®¡ç®—æ™ºèƒ½ä½“ç›¸ä¼¼åº¦ - åŸºäºç°æœ‰Agentå­—æ®µ"""
        
        # å¤šç»´åº¦ç›¸ä¼¼åº¦è®¡ç®—
        description_similarity = self._text_similarity(
            request.get("description", ""),
            existing_agent.description
        )
        
        tools_similarity = self._tools_similarity(
            request.get("tools", []),
            [tool.name for tool in existing_agent.selected_tools]
        )
        
        llm_type_similarity = 1.0 if request.get("llm_type") == existing_agent.llm_type else 0.0
        
        # åŠ æƒå¹³å‡
        total_similarity = (
            description_similarity * 0.5 +
            tools_similarity * 0.3 +
            llm_type_similarity * 0.2
        )
        
        return total_similarity
    
    def _text_similarity(self, text1: str, text2: str) -> float:
        """æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—"""
        return SequenceMatcher(None, text1.lower(), text2.lower()).ratio()
    
    def _tools_similarity(self, tools1: List[str], tools2: List[str]) -> float:
        """å·¥å…·ç›¸ä¼¼åº¦è®¡ç®—"""
        if not tools1 and not tools2:
            return 1.0
        if not tools1 or not tools2:
            return 0.0
        
        set1, set2 = set(tools1), set(tools2)
        intersection = len(set1.intersection(set2))
        union = len(set1.union(set2))
        
        return intersection / union if union > 0 else 0.0

    async def suggest_agent_reuse(self, agent_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ™ºèƒ½ä½“å¤ç”¨å»ºè®®"""
        
        similar_agents = await self.find_similar_agents(agent_request)
        
        if similar_agents:
            best_match = similar_agents[0]
            agent, score = best_match
            
            return {
                "should_reuse": True,
                "recommended_agent": {
                    "name": agent.agent_name,
                    "nick_name": agent.nick_name,
                    "description": agent.description,
                    "similarity_score": score,
                    "user_id": agent.user_id
                },
                "alternatives": [
                    {
                        "name": alt_agent.agent_name,
                        "similarity_score": alt_score
                    }
                    for alt_agent, alt_score in similar_agents[1:3]  # å‰3ä¸ªæ›¿ä»£é€‰é¡¹
                ]
            }
        else:
            return {
                "should_reuse": False,
                "recommended_agent": None,
                "reason": "æœªæ‰¾åˆ°ç›¸ä¼¼åº¦è¶³å¤Ÿé«˜çš„ç°æœ‰æ™ºèƒ½ä½“",
                "alternatives": []
            }
```

## åŠŸèƒ½3ï¼šå…±äº«æ™ºèƒ½ä½“ä»“åº“å’Œç‰ˆæœ¬ç®¡ç†

### **2.3 åŸºäºç°æœ‰å­˜å‚¨æœºåˆ¶çš„ä»“åº“ç®¡ç†**

#### **æŠ€æœ¯å®ç° - æ‰©å±•ç°æœ‰å­˜å‚¨ç»“æ„**
```python
# æ–°å»ºï¼šsrc/manager/shared_agent_repository.py
from src.manager.agents import AgentManager
from src.interface.agent import Agent
import json
from datetime import datetime
from pathlib import Path

class SharedAgentRepository:
    """å…±äº«æ™ºèƒ½ä½“ä»“åº“ - åŸºäºç°æœ‰å­˜å‚¨æœºåˆ¶æ‰©å±•"""
    
    def __init__(self, agent_manager: AgentManager):
        # âœ… å¤ç”¨ç°æœ‰AgentManagerå’Œå­˜å‚¨è·¯å¾„
        self.agent_manager = agent_manager
        self.shared_agents_dir = agent_manager.agents_dir / "shared"
        self.metadata_file = self.shared_agents_dir / "metadata.json"
        
        # ç¡®ä¿ç›®å½•å­˜åœ¨
        self.shared_agents_dir.mkdir(exist_ok=True)
        
        # æ™ºèƒ½ä½“å…ƒæ•°æ®ç®¡ç†
        self.agent_metadata = self._load_metadata()
    
    def _load_metadata(self) -> Dict[str, Any]:
        """åŠ è½½æ™ºèƒ½ä½“å…ƒæ•°æ®"""
        if self.metadata_file.exists():
            with open(self.metadata_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {"agents": {}, "stats": {}, "last_updated": datetime.now().isoformat()}
    
    def _save_metadata(self):
        """ä¿å­˜æ™ºèƒ½ä½“å…ƒæ•°æ®"""
        self.agent_metadata["last_updated"] = datetime.now().isoformat()
        with open(self.metadata_file, 'w', encoding='utf-8') as f:
            json.dump(self.agent_metadata, f, ensure_ascii=False, indent=2)
    
    async def register_shared_agent(
        self,
        agent: Agent,
        category: str = "general",
        tags: List[str] = None,
        performance_data: Dict[str, float] = None
    ) -> bool:
        """æ³¨å†Œå…±äº«æ™ºèƒ½ä½“ - âœ… åŸºäºç°æœ‰ä¿å­˜æœºåˆ¶"""
        
        try:
            # âœ… å¤ç”¨ç°æœ‰ä¿å­˜æœºåˆ¶
            await self.agent_manager._save_agent(agent, flush=True)
            
            # ğŸ”„ æ–°å¢ï¼šå…ƒæ•°æ®ç®¡ç†
            agent_id = agent.agent_name
            self.agent_metadata["agents"][agent_id] = {
                "name": agent.agent_name,
                "nick_name": agent.nick_name,
                "description": agent.description,
                "category": category,
                "tags": tags or [],
                "performance": performance_data or {},
                "created_at": datetime.now().isoformat(),
                "usage_count": 0,
                "rating": 0.0,
                "version": "1.0.0",
                "is_active": True
            }
            
            self._save_metadata()
            logger.info(f"å…±äº«æ™ºèƒ½ä½“æ³¨å†ŒæˆåŠŸ: {agent_id}")
            return True
            
        except Exception as e:
            logger.error(f"æ³¨å†Œå…±äº«æ™ºèƒ½ä½“å¤±è´¥: {e}")
            return False
    
    async def get_shared_agents_by_category(self, category: str = None) -> List[Dict[str, Any]]:
        """æŒ‰ç±»åˆ«è·å–å…±äº«æ™ºèƒ½ä½“"""
        
        # âœ… å¤ç”¨ç°æœ‰åˆ—è¡¨æ–¹æ³•
        shared_agents = await self.agent_manager._list_default_agents()
        
        result = []
        for agent in shared_agents:
            metadata = self.agent_metadata["agents"].get(agent.agent_name, {})
            
            if category and metadata.get("category") != category:
                continue
                
            result.append({
                "agent": agent,
                "metadata": metadata,
                "is_recommended": metadata.get("rating", 0) >= 4.0
            })
        
        # æŒ‰è¯„åˆ†å’Œä½¿ç”¨æ¬¡æ•°æ’åº
        result.sort(key=lambda x: (x["metadata"].get("rating", 0), x["metadata"].get("usage_count", 0)), reverse=True)
        return result
    
    async def record_agent_usage(self, agent_name: str, performance_score: float = None):
        """è®°å½•æ™ºèƒ½ä½“ä½¿ç”¨æƒ…å†µ"""
        
        if agent_name in self.agent_metadata["agents"]:
            metadata = self.agent_metadata["agents"][agent_name]
            metadata["usage_count"] += 1
            metadata["last_used"] = datetime.now().isoformat()
            
            # æ›´æ–°æ€§èƒ½è¯„åˆ†
            if performance_score is not None:
                current_rating = metadata.get("rating", 0.0)
                usage_count = metadata["usage_count"]
                
                # ç§»åŠ¨å¹³å‡æ›´æ–°è¯„åˆ†
                new_rating = (current_rating * (usage_count - 1) + performance_score) / usage_count
                metadata["rating"] = round(new_rating, 2)
            
            self._save_metadata()
    
    async def get_agent_recommendations(self, user_context: Dict[str, Any]) -> List[Dict[str, Any]]:
        """è·å–æ™ºèƒ½ä½“æ¨è"""
        
        travel_type = user_context.get("travel_type", "general")
        budget_level = user_context.get("budget_level", "mid_range")
        
        # è·å–ç›¸å…³ç±»åˆ«çš„æ™ºèƒ½ä½“
        category_mapping = {
            "cultural_tourism": "culture",
            "family_tourism": "family", 
            "adventure_tourism": "adventure",
            "budget": "budget"
        }
        
        recommended_category = category_mapping.get(travel_type) or category_mapping.get(budget_level, "general")
        agents = await self.get_shared_agents_by_category(recommended_category)
        
        # è¿”å›å‰5ä¸ªæ¨è
        return agents[:5]
```

## åŠŸèƒ½4ï¼šæ™ºèƒ½ä½“åˆ›å»ºå’Œå¤ç”¨å†³ç­–å¼•æ“

### **2.4 é›†æˆç°æœ‰å·¥ä½œæµçš„å†³ç­–æœºåˆ¶**

#### **æŠ€æœ¯å®ç° - æ‰©å±•ç°æœ‰agent_factory_node**
```python
# ä¿®æ”¹ï¼šsrc/workflow/agent_factory.py - å¢å¼ºç°æœ‰å·¥å‚èŠ‚ç‚¹
from src.manager.travel_agent_templates import TravelAgentTemplateManager
from src.manager.agent_similarity import AgentSimilarityDetector
from src.manager.shared_agent_repository import SharedAgentRepository

async def enhanced_travel_agent_factory_node(state: State) -> Command[Literal["publisher", "__end__"]]:
    """å¢å¼ºçš„æ™ºèƒ½ä½“å·¥å‚èŠ‚ç‚¹ - âœ… åŸºäºç°æœ‰èŠ‚ç‚¹æ‰©å±•"""
    
    logger.info("Enhanced Travel Agent Factory å¼€å§‹æ™ºèƒ½ä½“åˆ›å»ºå†³ç­–")
    
    # âœ… ä¿ç•™ç°æœ‰æ¶ˆæ¯å¤„ç†é€»è¾‘
    messages = apply_prompt_template("agent_factory", state)
    agent_spec = await (
        get_llm_by_type(AGENT_LLM_MAP["agent_factory"])
        .with_structured_output(AgentBuilder)
        .ainvoke(messages)
    )
    
    # ğŸ”„ æ–°å¢ï¼šåˆå§‹åŒ–æ‰©å±•ç»„ä»¶
    template_manager = TravelAgentTemplateManager(agent_manager)
    similarity_detector = AgentSimilarityDetector(agent_manager)
    shared_repository = SharedAgentRepository(agent_manager)
    
    # ğŸ”„ æ–°å¢ï¼šæ™ºèƒ½ä½“å¤ç”¨æ£€æµ‹
    agent_request = {
        "name": agent_spec["agent_name"],
        "description": agent_spec["agent_description"],
        "tools": [tool["name"] for tool in agent_spec["selected_tools"]],
        "llm_type": agent_spec["llm_type"]
    }
    
    reuse_suggestion = await similarity_detector.suggest_agent_reuse(agent_request)
    
    if reuse_suggestion["should_reuse"]:
        # æ¨èå¤ç”¨ç°æœ‰æ™ºèƒ½ä½“
        recommended_agent = reuse_suggestion["recommended_agent"]
        
        # è®°å½•ä½¿ç”¨
        await shared_repository.record_agent_usage(recommended_agent["name"])
        
        return Command(
            update={
                "messages": [{
                    "content": f"æ¨èå¤ç”¨ç°æœ‰æ™ºèƒ½ä½“ï¼š{recommended_agent['nick_name']} (ç›¸ä¼¼åº¦: {recommended_agent['similarity_score']:.2f})\n\n{recommended_agent['description']}\n\nè¿™ä¸ªæ™ºèƒ½ä½“å·²ç»è¿‡éªŒè¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚",
                    "tool": "agent_reuse_recommendation",
                    "role": "assistant",
                }],
                "reused_agent_name": recommended_agent["name"],
                "agent_name": "agent_factory",
            },
            goto="publisher",
        )
    
    else:
        # ğŸ”„ æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦æœ‰åˆé€‚çš„æ ‡å‡†æ¨¡æ¿
        travel_intent = state.get("travel_intent", {})
        recommended_template = await template_manager.get_recommended_agent(travel_intent)
        
        if recommended_template:
            # ä½¿ç”¨æ ‡å‡†æ¨¡æ¿åˆ›å»º
            template = template_manager.travel_templates[recommended_template]
            
            # âœ… å¤ç”¨ç°æœ‰åˆ›å»ºæœºåˆ¶
            tools = []
            for tool in template["tools"]:
                if tool.name in agent_manager.available_tools:
                    tools.append(tool)
            
            agent = await agent_manager._create_agent_by_prebuilt(
                user_id=state["user_id"],
                name=f"{template['name']}_{state['user_id']}",  # ç”¨æˆ·ä¸“å±å®ä¾‹
                nick_name=template["nick_name"],
                llm_type=template["llm_type"],
                tools=tools,
                prompt=template_manager._get_template_prompt(template["prompt_template"]),
                description=template["description"]
            )
            
            message = f"åŸºäºæ ‡å‡†æ¨¡æ¿åˆ›å»ºä¸“ä¸šæ—…æ¸¸æ™ºèƒ½ä½“ï¼š{template['nick_name']}\n\nä¸“ä¸šé¢†åŸŸï¼š{', '.join(template['specialties'])}\n\n{template['description']}"
            
        else:
            # âœ… å›é€€åˆ°ç°æœ‰åˆ›å»ºé€»è¾‘
            tools = []
            for tool in agent_spec["selected_tools"]:
                if agent_manager.available_tools.get(tool["name"]):
                    tools.append(agent_manager.available_tools[tool["name"]])
            
            agent = await agent_manager._create_agent_by_prebuilt(
                user_id=state["user_id"],
                name=agent_spec["agent_name"],
                nick_name=agent_spec["agent_name"],
                llm_type=agent_spec["llm_type"],
                tools=tools,
                prompt=agent_spec["prompt"],
                description=agent_spec["agent_description"],
            )
            
            message = f"åˆ›å»ºè‡ªå®šä¹‰æ™ºèƒ½ä½“ï¼š{agent_spec['agent_name']}\n\n{agent_spec['agent_description']}"
        
        # âœ… ä¿ç•™ç°æœ‰çŠ¶æ€æ›´æ–°é€»è¾‘
        state["TEAM_MEMBERS"].append(agent.agent_name)
        
        return Command(
            update={
                "messages": [{
                    "content": message,
                    "tool": "enhanced_agent_factory",
                    "role": "assistant",
                }],
                "new_agent_name": agent.agent_name,
                "agent_name": "enhanced_agent_factory",
            },
            goto="publisher",
        )
```

## åŠŸèƒ½5ï¼šç®¡ç†å‘˜æ ‡å‡†æ™ºèƒ½ä½“é¢„åˆ›å»ºæœºåˆ¶

### **2.5 åŸºäºç°æœ‰_load_default_agentsçš„æ‰©å±•**

#### **æŠ€æœ¯å®ç° - æ‰©å±•ç°æœ‰é»˜è®¤æ™ºèƒ½ä½“æœºåˆ¶**
```python
# ä¿®æ”¹ï¼šsrc/manager/agents.py - æ‰©å±•_load_default_agentsæ–¹æ³•
class AgentManager:
    # ... ç°æœ‰ä»£ç ä¿æŒä¸å˜ ...
    
    async def _load_default_agents(self):
        """åŠ è½½é»˜è®¤æ™ºèƒ½ä½“ - âœ… æ‰©å±•ç°æœ‰æ–¹æ³•"""
        
        # âœ… ä¿ç•™ç°æœ‰é»˜è®¤æ™ºèƒ½ä½“åˆ›å»º
        await self._create_agent_by_prebuilt(
            user_id="share",
            name="researcher",
            # ... ç°æœ‰ä»£ç ä¸å˜ ...
        )
        
        # ğŸ”„ æ–°å¢ï¼šåˆ›å»ºæ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“
        travel_template_manager = TravelAgentTemplateManager(self)
        await travel_template_manager.create_standard_travel_agents()
        
        logger.info("é»˜è®¤æ™ºèƒ½ä½“å’Œæ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“åŠ è½½å®Œæˆ")

# æ–°å»ºï¼šç®¡ç†å‘˜å·¥å…·è„šæœ¬
# scripts/create_travel_agents.py
async def create_standard_travel_agents():
    """ç®¡ç†å‘˜å·¥å…·ï¼šåˆ›å»ºæ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“"""
    
    from src.manager.agents import agent_manager
    from src.manager.travel_agent_templates import TravelAgentTemplateManager
    
    template_manager = TravelAgentTemplateManager(agent_manager)
    results = await template_manager.create_standard_travel_agents()
    
    print("æ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“åˆ›å»ºç»“æœï¼š")
    for template_id, result in results.items():
        status = "âœ… æˆåŠŸ" if result is True else "âš ï¸ å·²å­˜åœ¨" if result == "already_exists" else "âŒ å¤±è´¥"
        print(f"  {template_id}: {status}")

if __name__ == "__main__":
    import asyncio
    asyncio.run(create_standard_travel_agents())
```

---

## ğŸ“Š å…±äº«å¤ç”¨æœºåˆ¶æµç¨‹å›¾

### **å®Œæ•´å†³ç­–æµç¨‹**
```mermaid
graph TD
    A[ç”¨æˆ·è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“] --> B[åˆ†ææ™ºèƒ½ä½“éœ€æ±‚]
    
    B --> C{æ£€æŸ¥ç›¸ä¼¼åº¦}
    C -->|ç›¸ä¼¼åº¦>85%| D[æ¨èå¤ç”¨ç°æœ‰æ™ºèƒ½ä½“]
    C -->|ç›¸ä¼¼åº¦<85%| E{æ£€æŸ¥æ ‡å‡†æ¨¡æ¿}
    
    D --> F[è®°å½•ä½¿ç”¨æƒ…å†µ]
    F --> G[è¿”å›å¤ç”¨æ™ºèƒ½ä½“]
    
    E -->|æœ‰åˆé€‚æ¨¡æ¿| H[ä½¿ç”¨æ ‡å‡†æ¨¡æ¿åˆ›å»º]
    E -->|æ— åˆé€‚æ¨¡æ¿| I[è‡ªå®šä¹‰åˆ›å»ºæ™ºèƒ½ä½“]
    
    H --> J[åŸºäºæ¨¡æ¿ä¸ªæ€§åŒ–]
    I --> K[å®Œå…¨è‡ªå®šä¹‰åˆ›å»º]
    
    J --> L[ä¿å­˜åˆ°ç”¨æˆ·ç©ºé—´]
    K --> L
    
    L --> M{è¯„ä¼°æ˜¯å¦ä¼˜ç§€}
    M -->|è¡¨ç°ä¼˜ç§€| N[æ¨èåŠ å…¥å…±äº«åº“]
    M -->|è¡¨ç°ä¸€èˆ¬| O[ä»…ç”¨æˆ·ç§æœ‰]
    
    N --> P[ç®¡ç†å‘˜å®¡æ ¸]
    P -->|é€šè¿‡| Q[åŠ å…¥å…±äº«æ™ºèƒ½ä½“åº“]
    P -->|æ‹’ç»| O
    
    subgraph "å…±äº«æ™ºèƒ½ä½“åº“"
        R[æ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“]
        S[ç”¨æˆ·è´¡çŒ®æ™ºèƒ½ä½“]
        T[æ™ºèƒ½ä½“å…ƒæ•°æ®]
        U[ä½¿ç”¨ç»Ÿè®¡]
    end
    
    Q --> R
```

---

## ğŸš€ å®æ–½æ–¹æ¡ˆå’Œä¼˜åŒ–å»ºè®®

### 1. **é˜¶æ®µåŒ–å®æ–½ç­–ç•¥**

#### **ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼šåŸºç¡€å…±äº«æœºåˆ¶**
1. **åˆ›å»ºæ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿**
   - âœ… åŸºäºç°æœ‰_create_agent_by_prebuiltå®Œå…¨å¤ç”¨
   - ğŸ”„ æ·»åŠ 5ä¸ªæ ‡å‡†æ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿
   - âœ… é›†æˆåˆ°ç°æœ‰_load_default_agents

2. **æ™ºèƒ½ä½“ç›¸ä¼¼åº¦æ£€æµ‹**
   - âœ… åŸºäºç°æœ‰Agentæ•°æ®ç»“æ„
   - ğŸ”„ å®ç°æ–‡æœ¬å’Œå·¥å…·ç›¸ä¼¼åº¦ç®—æ³•
   - âœ… é›¶ä¿®æ”¹é›†æˆåˆ°ç°æœ‰æµç¨‹

#### **ç¬¬äºŒé˜¶æ®µï¼ˆ2-3å‘¨ï¼‰ï¼šé«˜çº§å¤ç”¨æœºåˆ¶**
1. **å…±äº«æ™ºèƒ½ä½“ä»“åº“**
   - âœ… æ‰©å±•ç°æœ‰å­˜å‚¨ç›®å½•ç»“æ„
   - ğŸ”„ æ·»åŠ å…ƒæ•°æ®ç®¡ç†
   - âœ… å¤ç”¨ç°æœ‰ä¿å­˜åŠ è½½æœºåˆ¶

2. **å†³ç­–å¼•æ“é›†æˆ**
   - âœ… æ‰©å±•ç°æœ‰agent_factory_node
   - ğŸ”„ æ·»åŠ æ™ºèƒ½æ¨èé€»è¾‘
   - âœ… ä¿æŒå‘åå…¼å®¹æ€§

#### **ç¬¬ä¸‰é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼šç®¡ç†å’Œä¼˜åŒ–**
1. **ç®¡ç†å‘˜å·¥å…·**
   - åŸºäºç°æœ‰FastAPIæ·»åŠ ç®¡ç†æ¥å£
   - æ™ºèƒ½ä½“æ€§èƒ½ç›‘æ§é¢æ¿
   - è‡ªåŠ¨åŒ–æ™ºèƒ½ä½“å®¡æ ¸æµç¨‹

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ™ºèƒ½ä½“ä½¿ç”¨æƒ…å†µåˆ†æ
   - è‡ªåŠ¨åŒ–æ¨èä¼˜åŒ–
   - A/Bæµ‹è¯•æ¡†æ¶

### 2. **ç°æœ‰æŠ€æœ¯åˆ©ç”¨ç‡åˆ†æ**

| ç»„ä»¶ | ç°æœ‰æŠ€æœ¯å¤ç”¨ç‡ | æ–°å¢å¼€å‘é‡ | ä¿®æ”¹ç°æœ‰ä»£ç  |
|------|----------------|-----------|-------------|
| **æ™ºèƒ½ä½“æ¨¡æ¿ç®¡ç†** | 95% | 5% | 0% |
| **ç›¸ä¼¼åº¦æ£€æµ‹** | 90% | 10% | 0% |
| **å…±äº«ä»“åº“** | 85% | 15% | 2% |
| **å†³ç­–å¼•æ“** | 88% | 12% | 3% |
| **ç®¡ç†å·¥å…·** | 80% | 20% | 1% |

### 3. **å…³é”®ä¼˜åŒ–ç‚¹**

#### **éœ€è¦å®Œå–„çš„åŠŸèƒ½ç‚¹**
1. **æ™ºèƒ½ä½“å…ƒæ•°æ®æ‰©å±•**
   ```python
   # åœ¨ç°æœ‰Agentç±»åŸºç¡€ä¸Šæ·»åŠ å…ƒæ•°æ®å­—æ®µ
   class EnhancedAgent(Agent):
       category: str = "general"
       tags: List[str] = []
       performance_score: float = 0.0
       usage_count: int = 0
       version: str = "1.0.0"
   ```

2. **ç›¸ä¼¼åº¦ç®—æ³•ä¼˜åŒ–**
   - å¼•å…¥æ›´å…ˆè¿›çš„è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—
   - æ·»åŠ å·¥å…·åŠŸèƒ½ç›¸ä¼¼åº¦æƒé‡
   - åŸºäºç”¨æˆ·åé¦ˆçš„åŠ¨æ€è°ƒæ•´

3. **æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šæœºåˆ¶
   - æ€§èƒ½ç›‘æ§å’Œè‡ªåŠ¨ä¼˜åŒ–
   - è¿‡æœŸæ™ºèƒ½ä½“æ¸…ç†æœºåˆ¶

### 4. **é£é™©æ§åˆ¶æªæ–½**

#### **æŠ€æœ¯é£é™©**
- **å‘åå…¼å®¹æ€§**ï¼šç¡®ä¿æ–°åŠŸèƒ½ä¸å½±å“ç°æœ‰å·¥ä½œæµ
- **æ€§èƒ½å½±å“**ï¼šç›¸ä¼¼åº¦æ£€æµ‹çš„è®¡ç®—å¤æ‚åº¦æ§åˆ¶
- **å­˜å‚¨æ‰©å±•**ï¼šæ™ºèƒ½ä½“æ•°é‡å¢é•¿çš„å­˜å‚¨ä¼˜åŒ–

#### **ä¸šåŠ¡é£é™©**
- **è´¨é‡æ§åˆ¶**ï¼šå…±äº«æ™ºèƒ½ä½“çš„è´¨é‡å®¡æ ¸æœºåˆ¶
- **æƒé™ç®¡ç†**ï¼šç”¨æˆ·åˆ›å»ºæ™ºèƒ½ä½“çš„æƒé™è¾¹ç•Œ
- **æ•°æ®å®‰å…¨**ï¼šç”¨æˆ·ä¸“å±æ™ºèƒ½ä½“çš„éšç§ä¿æŠ¤

---

## ğŸ“‹ æ€»ç»“

### **æ ¸å¿ƒä¼˜åŠ¿**
1. **é«˜å¤ç”¨ç‡**ï¼šå¹³å‡90%ä»¥ä¸Šç°æœ‰ä»£ç å¤ç”¨
2. **é›¶ç ´åæ€§**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½çš„æ­£å¸¸è¿è¡Œ
3. **æ¸è¿›å®æ–½**ï¼šå¯åˆ†é˜¶æ®µé€æ­¥å®Œå–„åŠŸèƒ½
4. **æ ‡å‡†åŒ–**ï¼šåŸºäºç°æœ‰æŠ€æœ¯æ ˆçš„ç»Ÿä¸€æ ‡å‡†

### **æŠ€æœ¯åˆ›æ–°ç‚¹**
1. **ç»§æ‰¿å¼æ‰©å±•**ï¼šåŸºäºç°æœ‰ç±»çš„åŠŸèƒ½å¢å¼º
2. **å…ƒæ•°æ®é©±åŠ¨**ï¼šæ™ºèƒ½ä½“çš„ä¸°å¯Œå…ƒæ•°æ®ç®¡ç†
3. **æ™ºèƒ½å†³ç­–**ï¼šè‡ªåŠ¨åŒ–çš„å¤ç”¨æ¨èæœºåˆ¶
4. **æ¨¡æ¿æ ‡å‡†åŒ–**ï¼šæ—…æ¸¸é¢†åŸŸçš„ä¸“ä¸šåŒ–æ¨¡æ¿

### **ä¸šåŠ¡ä»·å€¼**
1. **æå‡æ•ˆç‡**ï¼šé¿å…é‡å¤åˆ›å»ºï¼Œæé«˜æ™ºèƒ½ä½“å¤ç”¨ç‡
2. **ä¿è¯è´¨é‡**ï¼šæ ‡å‡†åŒ–æ¨¡æ¿ç¡®ä¿æ™ºèƒ½ä½“ä¸“ä¸šæ€§
3. **é™ä½æˆæœ¬**ï¼šå‡å°‘é‡å¤å¼€å‘å’Œç»´æŠ¤æˆæœ¬
4. **ä¿ƒè¿›å…±äº«**ï¼šå»ºç«‹æ™ºèƒ½ä½“ç”Ÿæ€å’ŒçŸ¥è¯†ç§¯ç´¯

è¿™ä¸ªæ–¹æ¡ˆåœ¨æœ€å¤§åŒ–åˆ©ç”¨ç°æœ‰æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œæ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½ä½“å…±äº«å¤ç”¨ç”Ÿæ€ï¼Œæ—¢è§£å†³äº†é‡å¤åˆ›å»ºçš„é—®é¢˜ï¼Œåˆä¿æŒäº†æŒç»­åˆ›æ–°çš„èƒ½åŠ›ï¼Œä¸ºæ—…æ¸¸å¤šæ™ºèƒ½ä½“äº§å“çš„å¿«é€Ÿå‘å±•å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚

---

## ğŸ¯ å…·ä½“æ—…æ¸¸æ™ºèƒ½ä½“å®æ–½æ–¹æ¡ˆ

åŸºäºç”¨æˆ·æå‡ºçš„5ä¸ªå…·ä½“æ—…æ¸¸æ™ºèƒ½ä½“éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡äº†å®Œæ•´çš„**ä¸“ä¸šåŒ–æ—…æ¸¸å·¥ä½œæµæ™ºèƒ½ä½“**è§£å†³æ–¹æ¡ˆã€‚

### 1. **æ ¸å¿ƒæ™ºèƒ½ä½“éœ€æ±‚åˆ†æ**

#### **æ™ºèƒ½ä½“åŠŸèƒ½å¯¹ç…§è¡¨**
| æ™ºèƒ½ä½“åç§° | æ ¸å¿ƒåŠŸèƒ½ | è¾“å…¥è¦æ±‚ | è¾“å‡ºå†…å®¹ | æŠ€æœ¯å·¥å…· |
|------------|----------|----------|----------|----------|
| **äº¤é€šè§„åˆ’æ™ºèƒ½ä½“** | å®‰æ’å‡ºå‘/åˆ°è¾¾æ—¶é—´ã€è·¯çº¿ã€ç¥¨ä»· | è¡Œç¨‹å®‰æ’ã€å‡ºå‘åœ°/ç›®çš„åœ° | è¯¦å°½äº¤é€šè®¡åˆ’ | tavily_tool, python_repl_tool, browser_tool |
| **è¡Œç¨‹è®¾è®¡æ™ºèƒ½ä½“** | æ¨èæ™¯ç‚¹ã€è®¾è®¡æ—¥ç¨‹ | ç›®çš„åœ°ã€ç”¨æˆ·åå¥½ | æ™¯ç‚¹æ¨è+ç…§ç‰‡URL+è¯¦ç»†æ—¥ç¨‹ | tavily_tool, browser_tool, python_repl_tool |
| **è´¹ç”¨è®¡ç®—æ™ºèƒ½ä½“** | ç»Ÿè®¡å„é¡¹èŠ±é”€ | äº¤é€šã€ä½å®¿ã€é—¨ç¥¨ã€é¤é¥®ä¿¡æ¯ | é¢„ç®—æ˜ç»†+æ€»èŠ±è´¹ | python_repl_tool, tavily_tool |
| **ç»“æœæ•´åˆæ™ºèƒ½ä½“** | ç”ŸæˆWordæ–‡æ¡£æŠ¥å‘Š | ä¸Šè¿°ä¸‰ä¸ªæ™ºèƒ½ä½“ç»“æœ | Wordæ–‡æ¡£+æœ¬åœ°ä¿å­˜ | python_repl_tool, mcp-doc |
| **æ—…æ¸¸åè°ƒä¸“å®¶** | å¤šæ™ºèƒ½ä½“ååŒè§„åˆ’ | å®Œæ•´æ—…æ¸¸éœ€æ±‚ | åè°ƒå„æ™ºèƒ½ä½“å®Œæˆæ•´ä½“æ–¹æ¡ˆ | æ‰€æœ‰å·¥å…· |

### 2. **æ™ºèƒ½ä½“åä½œå·¥ä½œæµç¨‹**

#### **å®Œæ•´åä½œæµç¨‹å›¾**
```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥æ—…æ¸¸éœ€æ±‚] --> B[æ—…æ¸¸åè°ƒä¸“å®¶åˆ†æ]
    
    B --> C[è¡Œç¨‹è®¾è®¡æ™ºèƒ½ä½“]
    C --> D[ç¡®å®šæ™¯ç‚¹å’Œæ—¥ç¨‹å®‰æ’]
    
    D --> E[äº¤é€šè§„åˆ’æ™ºèƒ½ä½“]
    E --> F[å®‰æ’å¾€è¿”å’Œå½“åœ°äº¤é€š]
    
    F --> G[è´¹ç”¨è®¡ç®—æ™ºèƒ½ä½“]
    G --> H[ç»Ÿè®¡æ‰€æœ‰å¼€æ”¯æ˜ç»†]
    
    H --> I[ç»“æœæ•´åˆæ™ºèƒ½ä½“]
    I --> J[ç”ŸæˆWordæ–‡æ¡£æŠ¥å‘Š]
    
    J --> K[ä¿å­˜åˆ°ç”¨æˆ·æ¡Œé¢]
    
    subgraph "æ•°æ®æµè½¬"
        L[æ™¯ç‚¹ä¿¡æ¯+æ—¶é—´å®‰æ’] --> M[äº¤é€šæ—¶åˆ»è¡¨è¦æ±‚]
        M --> N[è´¹ç”¨ç»Ÿè®¡æ•°æ®]
        N --> O[å®Œæ•´æŠ¥å‘Šå†…å®¹]
    end
    
    C --> L
    E --> M
    G --> N
    I --> O
```

### 3. **å…·ä½“å®ç°å‘½ä»¤åˆ†æ**

#### **3.1 å•æ™ºèƒ½ä½“åˆ›å»ºå‘½ä»¤**
åŸºäºç°æœ‰agent_factoryæœºåˆ¶ï¼Œç”¨æˆ·æä¾›çš„åˆ›å»ºå‘½ä»¤å°†è§¦å‘ï¼š

```bash
# 1. äº¤é€šè§„åˆ’æ™ºèƒ½ä½“åˆ›å»º
run --debug --user-id test --task-type agent_workflow \
  --message "åˆ›å»ºäº¤é€šè§„åˆ’æ™ºèƒ½ä½“ï¼šæ ¹æ®è¡Œç¨‹æˆ–å…¶ä»–æ™ºèƒ½ä½“è¾“å‡ºï¼Œå®‰æ’å‡ºå‘/åˆ°è¾¾æ—¶é—´ã€è·¯çº¿ã€ç¥¨ä»·ç­‰ï¼Œè¾“å‡ºè¯¦å°½äº¤é€šè®¡åˆ’ã€‚"

# ç³»ç»Ÿå¤„ç†æµç¨‹ï¼š
# â†’ enhanced_travel_agent_factory_node åˆ†æéœ€æ±‚
# â†’ ç›¸ä¼¼åº¦æ£€æµ‹ï¼šåŒ¹é… transportation_planner æ¨¡æ¿
# â†’ ä½¿ç”¨æ ‡å‡†æ¨¡æ¿åˆ›å»ºç”¨æˆ·ä¸“å±å®ä¾‹
# â†’ è¿”å›ï¼štransportation_planner_test
```

#### **3.2 å¤šæ™ºèƒ½ä½“ååŒå‘½ä»¤**
```bash
# 5. ç»¼åˆæ—…æ¸¸è§„åˆ’
run --debug --user-id test --task-type agent_workflow \
  --message "æˆ‘è®¡åˆ’äº 2025-05-22 è‡³ 2025-05-26ï¼Œä»ä¸Šæµ·å‡ºå‘å‰å¾€åŒ—äº¬æ¸¸ç©äº”å¤©ã€‚è¯·ç”ŸæˆåŒ…å«å¾€è¿”ä½ä»·èˆªç­ã€é£Ÿå®¿ã€æ™¯ç‚¹æ¨èä¸é¢„ç®—ç­‰çš„è¯¦ç»†æ—…æ¸¸è§„åˆ’ï¼Œæœ€ç»ˆä»¥ Word æ–‡æ¡£å½¢å¼ä¿å­˜è‡³æ¡Œé¢ã€‚"

# ç³»ç»Ÿå¤„ç†æµç¨‹ï¼š
# â†’ TravelCoordinator è¯†åˆ«ä¸ºå¤æ‚å¤šæ™ºèƒ½ä½“ä»»åŠ¡
# â†’ åˆ›å»º travel_coordinator æ™ºèƒ½ä½“
# â†’ æŒ‰åºè°ƒç”¨ï¼šitinerary_designer â†’ transportation_planner â†’ cost_calculator â†’ report_integrator
# â†’ ç”Ÿæˆå®Œæ•´Wordæ–‡æ¡£åˆ°æ¡Œé¢
```

### 4. **æŠ€æœ¯å®ç°å¢å¼ºæ–¹æ¡ˆ**

#### **4.1 æ™ºèƒ½ä½“é—´æ•°æ®ä¼ é€’æœºåˆ¶**
```python
# åŸºäºç°æœ‰Stateæœºåˆ¶æ‰©å±•
class TravelPlanningState(State):
    """æ—…æ¸¸è§„åˆ’ä¸“ç”¨çŠ¶æ€ç®¡ç†"""
    
    # è¡Œç¨‹è®¾è®¡ç»“æœ
    itinerary_data: Dict[str, Any] = {}
    
    # äº¤é€šè§„åˆ’ç»“æœ  
    transportation_data: Dict[str, Any] = {}
    
    # è´¹ç”¨è®¡ç®—ç»“æœ
    cost_data: Dict[str, Any] = {}
    
    # æœ€ç»ˆæŠ¥å‘Šæ•°æ®
    final_report: Dict[str, Any] = {}

# æ™ºèƒ½ä½“é—´æ•°æ®ä¼ é€’
async def itinerary_to_transportation_data_flow(state: TravelPlanningState):
    """è¡Œç¨‹æ•°æ®ä¼ é€’ç»™äº¤é€šè§„åˆ’"""
    
    itinerary = state.itinerary_data
    transportation_requirements = {
        "departure_city": state.get("departure", "ä¸Šæµ·"),
        "destination_city": state.get("destination", "åŒ—äº¬"),
        "travel_dates": itinerary.get("dates", []),
        "daily_locations": itinerary.get("daily_locations", []),
        "special_requirements": itinerary.get("transportation_needs", [])
    }
    
    state.update({"transportation_requirements": transportation_requirements})
    return state
```

#### **4.2 Wordæ–‡æ¡£ç”Ÿæˆå¢å¼º**
```python
# åŸºäºç°æœ‰MCP-Docå·¥å…·æ‰©å±•
async def generate_travel_report_word(
    itinerary_data: Dict,
    transportation_data: Dict, 
    cost_data: Dict,
    output_path: str = "~/Desktop/æ—…æ¸¸è§„åˆ’æŠ¥å‘Š.docx"
) -> str:
    """ç”Ÿæˆä¸“ä¸šæ—…æ¸¸è§„åˆ’WordæŠ¥å‘Š"""
    
    # âœ… å¤ç”¨ç°æœ‰MCP-Docå·¥å…·
    from src.tools.MCP-Doc.server import DocxProcessor
    
    processor = DocxProcessor()
    
    # åˆ›å»ºæ–°æ–‡æ¡£
    await processor.create_document(output_path)
    
    # æ·»åŠ å°é¢
    await processor.add_heading("åŒ—äº¬5æ—¥æ¸¸æ—…æ¸¸è§„åˆ’", level=1)
    await processor.add_paragraph(f"è§„åˆ’æ—¥æœŸï¼š{transportation_data.get('travel_dates', '')}")
    
    # æ·»åŠ ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    await processor.add_heading("ç›®å½•", level=2)
    
    # æ·»åŠ è¡Œç¨‹å®‰æ’
    await processor.add_heading("è¯¦ç»†è¡Œç¨‹å®‰æ’", level=2)
    for day, activities in itinerary_data.get("daily_plan", {}).items():
        await processor.add_heading(f"{day}", level=3)
        for activity in activities:
            await processor.add_paragraph(f"â€¢ {activity['name']}: {activity['description']}")
            # æ’å…¥æ™¯ç‚¹å›¾ç‰‡
            if activity.get('image_url'):
                await processor.add_picture(activity['image_url'])
    
    # æ·»åŠ äº¤é€šå®‰æ’è¡¨æ ¼
    await processor.add_heading("äº¤é€šå®‰æ’è¯¦æƒ…", level=2)
    transport_table = transportation_data.get("schedule_table", [])
    await processor.add_table(transport_table)
    
    # æ·»åŠ è´¹ç”¨æ˜ç»†è¡¨æ ¼
    await processor.add_heading("è´¹ç”¨é¢„ç®—æ˜ç»†", level=2)
    cost_table = cost_data.get("expense_table", [])
    await processor.add_table(cost_table)
    
    # æ·»åŠ å®ç”¨ä¿¡æ¯
    await processor.add_heading("å®ç”¨ä¿¡æ¯å’Œè´´å£«", level=2)
    tips = itinerary_data.get("travel_tips", [])
    for tip in tips:
        await processor.add_paragraph(f"ğŸ’¡ {tip}")
    
    # ä¿å­˜æ–‡æ¡£
    await processor.save_document()
    
    return f"æ—…æ¸¸è§„åˆ’æŠ¥å‘Šå·²ä¿å­˜è‡³ï¼š{output_path}"
```

### 5. **æ™ºèƒ½ä½“è´¨é‡ä¿è¯æœºåˆ¶**

#### **5.1 æ™ºèƒ½ä½“è¾“å‡ºéªŒè¯**
```python
class TravelAgentOutputValidator:
    """æ—…æ¸¸æ™ºèƒ½ä½“è¾“å‡ºè´¨é‡éªŒè¯å™¨"""
    
    def validate_itinerary_output(self, output: Dict) -> bool:
        """éªŒè¯è¡Œç¨‹è®¾è®¡è¾“å‡º"""
        required_fields = ["daily_plan", "attractions", "schedule", "tips"]
        return all(field in output for field in required_fields)
    
    def validate_transportation_output(self, output: Dict) -> bool:
        """éªŒè¯äº¤é€šè§„åˆ’è¾“å‡º"""
        required_fields = ["outbound_flight", "return_flight", "local_transport", "total_cost"]
        return all(field in output for field in required_fields)
    
    def validate_cost_output(self, output: Dict) -> bool:
        """éªŒè¯è´¹ç”¨è®¡ç®—è¾“å‡º"""
        required_fields = ["expense_breakdown", "total_cost", "cost_per_person", "savings_tips"]
        return all(field in output for field in required_fields)
```

#### **5.2 åè°ƒæ™ºèƒ½ä½“è´¨é‡æ§åˆ¶**
```python
async def travel_coordination_quality_check(state: TravelPlanningState) -> bool:
    """æ—…æ¸¸åè°ƒè´¨é‡æ£€æŸ¥"""
    
    # æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
    if not all([state.itinerary_data, state.transportation_data, state.cost_data]):
        logger.warning("æ—…æ¸¸è§„åˆ’æ•°æ®ä¸å®Œæ•´")
        return False
    
    # æ£€æŸ¥æ—¶é—´ä¸€è‡´æ€§
    itinerary_dates = state.itinerary_data.get("dates", [])
    transport_dates = state.transportation_data.get("travel_dates", [])
    
    if itinerary_dates != transport_dates:
        logger.warning("è¡Œç¨‹å’Œäº¤é€šæ—¥æœŸä¸ä¸€è‡´")
        return False
    
    # æ£€æŸ¥è´¹ç”¨åˆç†æ€§
    total_cost = state.cost_data.get("total_cost", 0)
    if total_cost <= 0:
        logger.warning("è´¹ç”¨è®¡ç®—å¼‚å¸¸")
        return False
    
    return True
```

### 6. **å®æ–½ä¼˜å…ˆçº§å’Œæ—¶é—´è§„åˆ’**

#### **ç¬¬ä¸€é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šåŸºç¡€æ™ºèƒ½ä½“åˆ›å»º**
1. **å®Œå–„ç°æœ‰æ¨¡æ¿ç³»ç»Ÿ**
   - âœ… æ·»åŠ 5ä¸ªä¸“ä¸šæ—…æ¸¸æ™ºèƒ½ä½“æ¨¡æ¿ï¼ˆå·²å®Œæˆï¼‰
   - ğŸ”„ æµ‹è¯•å•ä¸ªæ™ºèƒ½ä½“åˆ›å»ºå’Œè¿è¡Œ
   - ğŸ”„ éªŒè¯å·¥å…·é›†æˆå’ŒåŠŸèƒ½æ­£å¸¸

2. **åŸºç¡€åŠŸèƒ½éªŒè¯**
   - æµ‹è¯•å‘½ä»¤ï¼šåˆ›å»ºäº¤é€šè§„åˆ’æ™ºèƒ½ä½“
   - æµ‹è¯•å‘½ä»¤ï¼šåˆ›å»ºè¡Œç¨‹è®¾è®¡æ™ºèƒ½ä½“
   - æµ‹è¯•å‘½ä»¤ï¼šåˆ›å»ºè´¹ç”¨è®¡ç®—æ™ºèƒ½ä½“

#### **ç¬¬äºŒé˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼šåä½œæœºåˆ¶å®ç°**
1. **æ™ºèƒ½ä½“é—´æ•°æ®ä¼ é€’**
   - ğŸ”„ æ‰©å±•Stateæ•°æ®ç»“æ„
   - ğŸ”„ å®ç°æ™ºèƒ½ä½“é—´æ•°æ®æµè½¬
   - ğŸ”„ æ·»åŠ æ•°æ®éªŒè¯æœºåˆ¶

2. **åè°ƒæ™ºèƒ½ä½“å®Œå–„**
   - ğŸ”„ å®ç°travel_coordinatorå·¥ä½œæµ
   - ğŸ”„ æ·»åŠ è´¨é‡æ£€æŸ¥æœºåˆ¶
   - ğŸ”„ æµ‹è¯•å¤šæ™ºèƒ½ä½“ååŒ

#### **ç¬¬ä¸‰é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šWordæ–‡æ¡£ç”Ÿæˆ**
1. **æŠ¥å‘Šæ•´åˆåŠŸèƒ½**
   - âœ… åˆ©ç”¨ç°æœ‰MCP-Docå·¥å…·
   - ğŸ”„ è®¾è®¡ä¸“ä¸šæŠ¥å‘Šæ¨¡æ¿
   - ğŸ”„ å®ç°å›¾ç‰‡å’Œè¡¨æ ¼æ’å…¥

2. **ç«¯åˆ°ç«¯æµ‹è¯•**
   - ğŸ”„ å®Œæ•´æµç¨‹æµ‹è¯•ï¼ˆä¸Šæµ·â†’åŒ—äº¬5æ—¥æ¸¸ï¼‰
   - ğŸ”„ æ–‡æ¡£è´¨é‡æ£€æŸ¥
   - ğŸ”„ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 7. **é¢„æœŸæ•ˆæœå’ŒæˆåŠŸæŒ‡æ ‡**

#### **åŠŸèƒ½å®Œæ•´æ€§æŒ‡æ ‡**
- âœ… 5ä¸ªä¸“ä¸šæ™ºèƒ½ä½“åˆ›å»ºæˆåŠŸç‡ > 95%
- âœ… æ™ºèƒ½ä½“åä½œæˆåŠŸç‡ > 90%
- âœ… Wordæ–‡æ¡£ç”ŸæˆæˆåŠŸç‡ > 95%
- âœ… ç«¯åˆ°ç«¯æµç¨‹å®Œæˆæ—¶é—´ < 10åˆ†é’Ÿ

#### **è´¨é‡ä¿è¯æŒ‡æ ‡**
- âœ… è¡Œç¨‹å®‰æ’åˆç†æ€§æ£€æŸ¥é€šè¿‡ç‡ > 90%
- âœ… äº¤é€šæ—¶é—´è¡”æ¥å‡†ç¡®ç‡ > 95%
- âœ… è´¹ç”¨è®¡ç®—å‡†ç¡®æ€§ > 98%
- âœ… ç”Ÿæˆæ–‡æ¡£ä¸“ä¸šåº¦è¯„åˆ† > 4.0/5.0

#### **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
- âœ… ç”¨æˆ·æ“ä½œæ­¥éª¤ â‰¤ 3æ­¥ï¼ˆè¾“å…¥éœ€æ±‚â†’ç­‰å¾…å¤„ç†â†’è·å¾—æ–‡æ¡£ï¼‰
- âœ… æ–‡æ¡£å†…å®¹æ»¡æ„åº¦ > 4.0/5.0
- âœ… é‡å¤ä½¿ç”¨æ„æ„¿ > 80%

---

## ğŸ“‹ è¡¥å……æ€»ç»“

é€šè¿‡åˆ†æç”¨æˆ·çš„å…·ä½“éœ€æ±‚ï¼Œæˆ‘ä»¬åœ¨åŸæœ‰å…±äº«æ™ºèƒ½ä½“æ–¹æ¡ˆåŸºç¡€ä¸Šï¼Œ**æ–°å¢äº†5ä¸ªä¸“ä¸šåŒ–æ—…æ¸¸å·¥ä½œæµæ™ºèƒ½ä½“**ï¼š

### **æ–°å¢æ™ºèƒ½ä½“ä»·å€¼**
1. **transportation_planner** - è§£å†³äº¤é€šè§„åˆ’ä¸“ä¸šåŒ–éœ€æ±‚
2. **itinerary_designer** - è§£å†³è¡Œç¨‹è®¾è®¡å’Œæ™¯ç‚¹æ¨èéœ€æ±‚  
3. **cost_calculator** - è§£å†³ç²¾ç¡®è´¹ç”¨è®¡ç®—éœ€æ±‚
4. **report_integrator** - è§£å†³Wordæ–‡æ¡£ç”Ÿæˆéœ€æ±‚
5. **travel_coordinator** - è§£å†³å¤šæ™ºèƒ½ä½“ååŒéœ€æ±‚

### **æŠ€æœ¯å®ç°ä¼˜åŠ¿**
- **100%å¤ç”¨ç°æœ‰æŠ€æœ¯**ï¼šåŸºäºç°æœ‰æ¨¡æ¿ç®¡ç†ã€MCPå·¥å…·ã€Stateç®¡ç†
- **ä¸“ä¸šåŒ–ç¨‹åº¦é«˜**ï¼šé’ˆå¯¹æ—…æ¸¸è§„åˆ’æµç¨‹çš„æ·±åº¦å®šåˆ¶
- **åä½œæœºåˆ¶å®Œå–„**ï¼šæ™ºèƒ½ä½“é—´æ•°æ®ä¼ é€’å’Œè´¨é‡ä¿è¯
- **ç”¨æˆ·ä½“éªŒä¼˜ç§€**ï¼šä¸€é”®ç”Ÿæˆä¸“ä¸šæ—…æ¸¸è§„åˆ’æ–‡æ¡£

è¿™å¥—æ–¹æ¡ˆæ—¢æ»¡è¶³äº†ç”¨æˆ·çš„å…·ä½“éœ€æ±‚ï¼Œåˆä¿æŒäº†ä¸ç°æœ‰ç³»ç»Ÿçš„å®Œç¾å…¼å®¹ï¼Œä¸ºæ—…æ¸¸å¤šæ™ºèƒ½ä½“äº§å“çš„å¿«é€Ÿè½åœ°æä¾›äº†å®Œæ•´çš„æŠ€æœ¯è·¯å¾„ã€‚ 