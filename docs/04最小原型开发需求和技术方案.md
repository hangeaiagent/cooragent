# æœ€å°åŸå‹å¼€å‘éœ€æ±‚å’ŒæŠ€æœ¯æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

å®ç°ä¸€ä¸ªæœ€å°å¯è¡Œçš„WebåŸå‹ï¼Œç”¨æˆ·é€šè¿‡"ä¸€å¥è¯è¾“å…¥éœ€æ±‚"ï¼Œç³»ç»Ÿåå°åŸºäºCooragentæ ¸å¿ƒæ¶æ„è‡ªåŠ¨ç”Ÿæˆç²¾ç®€ç‰ˆå¤šæ™ºèƒ½ä½“åº”ç”¨æºä»£ç ï¼Œæ‰“åŒ…å‹ç¼©åæä¾›ä¸‹è½½ã€‚ç”Ÿæˆçš„é¡¹ç›®æ˜¯Cooragentçš„å®šåˆ¶åŒ–ç‰ˆæœ¬ï¼Œä¿ç•™æ ¸å¿ƒåŠŸèƒ½å¹¶é’ˆå¯¹ç”¨æˆ·éœ€æ±‚è¿›è¡Œä¼˜åŒ–é…ç½®ã€‚

## ä¸€ã€åŠŸèƒ½éœ€æ±‚åˆ†æ

### 1.1 æ ¸å¿ƒåŠŸèƒ½æµç¨‹

```
ç”¨æˆ·è¾“å…¥ä¸€å¥è¯éœ€æ±‚ â†’ åå°æ™ºèƒ½ä½“åä½œç”Ÿæˆæ–¹æ¡ˆ â†’ è‡ªåŠ¨ç”Ÿæˆå®Œæ•´é¡¹ç›®ä»£ç  â†’ å‹ç¼©æ‰“åŒ… â†’ æä¾›ä¸‹è½½
```

### 1.2 è¯¦ç»†åŠŸèƒ½è¯´æ˜

#### ç”¨æˆ·äº¤äº’ç•Œé¢
- **ç®€æ´è¾“å…¥æ¡†**: ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€æè¿°çš„éœ€æ±‚
- **ç”ŸæˆæŒ‰é’®**: è§¦å‘ä»£ç ç”Ÿæˆæµç¨‹
- **ä¸‹è½½æŒ‰é’®**: ç”Ÿæˆå®Œæˆåæä¾›å‹ç¼©åŒ…ä¸‹è½½
- **çŠ¶æ€æç¤º**: æ˜¾ç¤º"æ­£åœ¨ç”Ÿæˆ..."ã€"ç”Ÿæˆå®Œæˆ"ç­‰çŠ¶æ€

#### åå°å¤„ç†é€»è¾‘
- **éœ€æ±‚åˆ†æ**: è°ƒç”¨ç°æœ‰çš„coordinatorâ†’plannerâ†’publisherâ†’agent_proxyå·¥ä½œæµ
- **æ™ºèƒ½ä½“é…ç½®**: è‡ªåŠ¨ç”Ÿæˆæˆ–é€‰æ‹©åˆé€‚çš„æ™ºèƒ½ä½“é…ç½®
- **ä»£ç ç”Ÿæˆ**: æ ¹æ®æ™ºèƒ½ä½“é…ç½®ç”Ÿæˆå®Œæ•´çš„å¯éƒ¨ç½²é¡¹ç›®
- **é¡¹ç›®æ‰“åŒ…**: è‡ªåŠ¨å‹ç¼©ç”Ÿæˆçš„é¡¹ç›®æ–‡ä»¶
- **æ–‡ä»¶æ¸…ç†**: å®šæœŸæ¸…ç†ä¸´æ—¶ç”Ÿæˆçš„æ–‡ä»¶

#### ç”Ÿæˆçš„é¡¹ç›®ç»“æ„ (åŸºäºCooragentæ¶æ„)
```
generated_project/
â”œâ”€â”€ src/                     # æ ¸å¿ƒæºç ç›®å½• (åŸºäºCooragentæ¶æ„)
â”‚   â”œâ”€â”€ interface/           # æ¥å£å®šä¹‰ (å¤ç”¨Cooragent)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ agent.py        # æ™ºèƒ½ä½“æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ workflow.py     # å·¥ä½œæµæ¥å£
â”‚   â”‚   â””â”€â”€ serializer.py   # åºåˆ—åŒ–å·¥å…·
â”‚   â”œâ”€â”€ workflow/            # å·¥ä½œæµå¼•æ“ (ç®€åŒ–ç‰ˆCooragent)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ graph.py        # å·¥ä½œæµå›¾å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ process.py      # å·¥ä½œæµæ‰§è¡Œå™¨
â”‚   â”‚   â””â”€â”€ cache.py        # çŠ¶æ€ç¼“å­˜
â”‚   â”œâ”€â”€ manager/             # æ™ºèƒ½ä½“ç®¡ç† (ç²¾ç®€ç‰ˆ)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ agents.py       # æ™ºèƒ½ä½“ç®¡ç†å™¨
â”‚   â”œâ”€â”€ llm/                 # LLMé›†æˆ (å¤ç”¨Cooragent)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ llm.py          # LLMç»Ÿä¸€æ¥å£
â”‚   â”‚   â””â”€â”€ agents.py       # æ™ºèƒ½ä½“-LLMæ˜ å°„
â”‚   â”œâ”€â”€ tools/               # å·¥å…·é›†åˆ (æ ¹æ®éœ€æ±‚å®šåˆ¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ search.py       # æœç´¢å·¥å…·
â”‚   â”‚   â”œâ”€â”€ python_repl.py  # Pythonæ‰§è¡Œå™¨
â”‚   â”‚   â””â”€â”€ crawl.py        # ç½‘é¡µçˆ¬å–å·¥å…·
â”‚   â”œâ”€â”€ prompts/             # æç¤ºè¯æ¨¡æ¿ (å®šåˆ¶åŒ–)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ template.py     # æ¨¡æ¿å¼•æ“
â”‚   â”‚   â”œâ”€â”€ coordinator.md  # åè°ƒå™¨æç¤ºè¯
â”‚   â”‚   â”œâ”€â”€ researcher.md   # ç ”ç©¶å‘˜æç¤ºè¯
â”‚   â”‚   â””â”€â”€ reporter.md     # æŠ¥å‘Šå‘˜æç¤ºè¯
â”‚   â”œâ”€â”€ service/             # æœåŠ¡å±‚ (ç®€åŒ–ç‰ˆ)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ server.py       # WebæœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ session.py      # ä¼šè¯ç®¡ç†
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ path_utils.py   # è·¯å¾„å·¥å…·
â”‚       â””â”€â”€ content_process.py # å†…å®¹å¤„ç†
â”œâ”€â”€ config/                  # é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ global_variables.py # å…¨å±€å˜é‡
â”‚   â””â”€â”€ workflow.json       # å·¥ä½œæµé…ç½®
â”œâ”€â”€ store/                   # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ agents/             # æ™ºèƒ½ä½“å®šä¹‰å­˜å‚¨
â”‚   â”œâ”€â”€ prompts/            # æç¤ºè¯å­˜å‚¨
â”‚   â””â”€â”€ workflows/          # å·¥ä½œæµç¼“å­˜
â”œâ”€â”€ cli.py                  # å‘½ä»¤è¡Œå·¥å…· (ç®€åŒ–ç‰ˆ)
â”œâ”€â”€ main.py                 # Webåº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt        # ä¾èµ–æ¸…å•
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ Dockerfile             # Dockeréƒ¨ç½²æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml     # Docker Composeé…ç½®
â”œâ”€â”€ README.md              # ä½¿ç”¨è¯´æ˜
â””â”€â”€ pyproject.toml         # é¡¹ç›®é…ç½®
```

### 1.3 éåŠŸèƒ½éœ€æ±‚

- **å“åº”æ—¶é—´**: ä»£ç ç”Ÿæˆæ—¶é—´æ§åˆ¶åœ¨30-60ç§’å†…
- **æ–‡ä»¶å¤§å°**: ç”Ÿæˆçš„å‹ç¼©åŒ…ä¸è¶…è¿‡10MB
- **å¹¶å‘æ”¯æŒ**: æ”¯æŒå¤šç”¨æˆ·åŒæ—¶ç”Ÿæˆï¼Œé¿å…èµ„æºå†²çª
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºå’Œå¼‚å¸¸å¤„ç†
- **æ–‡ä»¶æ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¶…è¿‡24å°æ—¶çš„ä¸´æ—¶æ–‡ä»¶

## äºŒã€æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### 2.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web å‰ç«¯      â”‚â”€â”€â”€â†’â”‚   FastAPI åç«¯   â”‚â”€â”€â”€â†’â”‚  ä»£ç ç”Ÿæˆå™¨     â”‚
â”‚ (ç®€æ´ç•Œé¢)      â”‚    â”‚ (API + é™æ€æ–‡ä»¶) â”‚    â”‚ (æ ¸å¿ƒé€»è¾‘)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                         â”‚
                              â†“                         â†“
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ ç°æœ‰å·¥ä½œæµ   â”‚         â”‚  é¡¹ç›®æ¨¡æ¿åº“     â”‚
                       â”‚ ç³»ç»Ÿè°ƒç”¨     â”‚         â”‚ (ä»£ç æ¨¡æ¿)      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                         â”‚
                              â†“                         â†“
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ æ™ºèƒ½ä½“é…ç½®   â”‚         â”‚  æ–‡ä»¶å‹ç¼©       â”‚
                       â”‚ ç”Ÿæˆç»“æœ     â”‚         â”‚  ä¸‹è½½æœåŠ¡       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 2.2.1 é¡¹ç›®ä»£ç ç”Ÿæˆå™¨ (åŸºäºCooragentæ¶æ„)

```python
# src/generator/cooragent_generator.py
class CooragentProjectGenerator:
    """åŸºäºCooragentæ¶æ„çš„é¡¹ç›®ä»£ç ç”Ÿæˆå™¨"""
    
    def __init__(self):
        self.cooragent_root = Path(__file__).parent.parent.parent  # Cooragentæ ¹ç›®å½•
        self.output_dir = Path("generated_projects")
        
    async def generate_project(self, user_input: str, user_id: str) -> str:
        """ç”ŸæˆåŸºäºCooragentçš„ç²¾ç®€é¡¹ç›®"""
        # 1. è°ƒç”¨ç°æœ‰å·¥ä½œæµç³»ç»Ÿè·å–æ™ºèƒ½ä½“é…ç½®
        workflow_result = await self._run_workflow(user_input, user_id)
        
        # 2. åˆ†æç”Ÿæˆçš„æ™ºèƒ½ä½“å’Œå·¥å…·éœ€æ±‚
        project_config = await self._analyze_project_requirements(workflow_result, user_id)
        
        # 3. å¤åˆ¶Cooragentæ ¸å¿ƒä»£ç å¹¶å®šåˆ¶åŒ–
        project_path = await self._generate_customized_project(project_config, user_id)
        
        # 4. å‹ç¼©é¡¹ç›®
        zip_path = await self._compress_project(project_path)
        
        return zip_path
    
    async def _run_workflow(self, user_input: str, user_id: str):
        """è°ƒç”¨ç°æœ‰å·¥ä½œæµç³»ç»Ÿåˆ†æéœ€æ±‚"""
        from src.workflow.process import run_agent_workflow
        
        messages = [{"role": "user", "content": user_input}]
        
        # ä½¿ç”¨Launchæ¨¡å¼åˆ†æç”¨æˆ·éœ€æ±‚å¹¶ç”Ÿæˆæ™ºèƒ½ä½“é…ç½®
        result = await run_agent_workflow(
            user_id=user_id,
            task_type="agent_workflow",
            user_input_messages=messages,
            debug=False,
            deep_thinking_mode=True,
            search_before_planning=True,
            workmode="launch"
        )
                
        return result
    
    async def _analyze_project_requirements(self, workflow_result, user_id: str) -> dict:
        """åˆ†æé¡¹ç›®éœ€æ±‚å¹¶ç¡®å®šéœ€è¦çš„ç»„ä»¶"""
        from src.manager import agent_manager
        
        # è·å–æœ¬æ¬¡å·¥ä½œæµåˆ›å»ºçš„æ™ºèƒ½ä½“
        created_agents = []
        used_tools = set()
        
        for agent_name, agent in agent_manager.available_agents.items():
            if agent.user_id == user_id:  # åªè·å–ç”¨æˆ·ç‰¹å®šçš„æ™ºèƒ½ä½“
                created_agents.append(agent)
                # æ”¶é›†ä½¿ç”¨çš„å·¥å…·
                for tool in agent.selected_tools:
                    used_tools.add(tool.name)
        
        # åˆ†æéœ€è¦çš„Cooragentç»„ä»¶
        required_components = self._determine_required_components(created_agents, used_tools)
        
        return {
            "agents": created_agents,
            "tools": list(used_tools),
            "components": required_components,
            "workflow_config": self._generate_workflow_config(created_agents)
        }
    
    def _determine_required_components(self, agents: list, tools: set) -> dict:
        """ç¡®å®šéœ€è¦å¤åˆ¶çš„Cooragentç»„ä»¶"""
        components = {
            # æ ¸å¿ƒç»„ä»¶ (æ€»æ˜¯éœ€è¦)
            "interface": ["agent.py", "workflow.py", "serializer.py"],
            "workflow": ["graph.py", "process.py", "cache.py"],
            "manager": ["agents.py"],
            "llm": ["llm.py", "agents.py"],
            "prompts": ["template.py"],
            "utils": ["path_utils.py", "content_process.py"],
            "service": ["server.py", "session.py"],
            
            # æ ¹æ®å·¥å…·éœ€æ±‚é€‰æ‹©
            "tools": [],
            "prompts_md": ["coordinator.md"]  # ç³»ç»Ÿæç¤ºè¯
        }
        
        # æ ¹æ®ä½¿ç”¨çš„å·¥å…·ç¡®å®šéœ€è¦å¤åˆ¶çš„å·¥å…·æ–‡ä»¶
        tool_mapping = {
            "tavily_tool": "search.py",
            "python_repl_tool": "python_repl.py", 
            "bash_tool": "bash_tool.py",
            "crawl_tool": "crawl.py",
            "browser_tool": "browser.py"
        }
        
        for tool in tools:
            if tool in tool_mapping:
                components["tools"].append(tool_mapping[tool])
        
        # æ ¹æ®æ™ºèƒ½ä½“ç¡®å®šéœ€è¦çš„æç¤ºè¯
        for agent in agents:
            if agent.agent_name in ["researcher", "coder", "reporter", "browser"]:
                components["prompts_md"].append(f"{agent.agent_name}.md")
        
        return components
    
    async def _generate_customized_project(self, config: dict, user_id: str) -> Path:
        """ç”Ÿæˆå®šåˆ¶åŒ–çš„Cooragenté¡¹ç›®"""
        project_name = f"cooragent_app_{user_id}_{int(time.time())}"
        project_path = self.output_dir / project_name
        
        # åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
        await self._create_project_structure(project_path)
        
        # å¤åˆ¶å¹¶å®šåˆ¶åŒ–Cooragentæ ¸å¿ƒä»£ç 
        await self._copy_cooragent_components(project_path, config["components"])
        
        # ç”Ÿæˆå®šåˆ¶åŒ–é…ç½®æ–‡ä»¶
        await self._generate_custom_configs(project_path, config)
        
        # ç”Ÿæˆä¸»åº”ç”¨å…¥å£
        await self._generate_main_application(project_path, config)
        
        # ç”Ÿæˆéƒ¨ç½²æ–‡ä»¶
        await self._generate_deployment_files(project_path, config)
        
        # ç”Ÿæˆæ–‡æ¡£
        await self._generate_project_documentation(project_path, config)
        
        return project_path
    
    async def _copy_cooragent_components(self, project_path: Path, components: dict):
        """å¤åˆ¶Cooragentæ ¸å¿ƒç»„ä»¶åˆ°é¡¹ç›®ä¸­"""
        import shutil
        
        src_path = project_path / "src"
        
        for component_type, files in components.items():
            if component_type == "prompts_md":
                # ç‰¹æ®Šå¤„ç†æç¤ºè¯æ–‡ä»¶
                target_dir = src_path / "prompts"
                source_dir = self.cooragent_root / "src" / "prompts"
                
                for file in files:
                    if (source_dir / file).exists():
                        shutil.copy2(source_dir / file, target_dir / file)
            else:
                # å¤åˆ¶å…¶ä»–ç»„ä»¶
                target_dir = src_path / component_type
                source_dir = self.cooragent_root / "src" / component_type
                
                target_dir.mkdir(parents=True, exist_ok=True)
                
                for file in files:
                    source_file = source_dir / file
                    if source_file.exists():
                        if source_file.is_file():
                            shutil.copy2(source_file, target_dir / file)
                        else:
                            shutil.copytree(source_file, target_dir / file, dirs_exist_ok=True)
                
                # ç¡®ä¿æœ‰__init__.pyæ–‡ä»¶
                init_file = target_dir / "__init__.py"
                if not init_file.exists():
                    init_file.touch()
```

#### 2.2.2 é…ç½®å’Œå…¥å£æ–‡ä»¶ç”Ÿæˆå™¨

```python
# src/generator/config_generator.py
class ConfigGenerator:
    """é…ç½®å’Œå…¥å£æ–‡ä»¶ç”Ÿæˆå™¨"""
    
    async def generate_main_app(self, project_path: Path, config: dict):
        """ç”Ÿæˆä¸»åº”ç”¨å…¥å£æ–‡ä»¶"""
        main_content = self._render_main_app_template(config)
        
        async with aiofiles.open(project_path / "main.py", "w", encoding="utf-8") as f:
            await f.write(main_content)
    
    def _render_main_app_template(self, config: dict) -> str:
        """æ¸²æŸ“ä¸»åº”ç”¨æ¨¡æ¿"""
        agents = config["agents"]
        agent_names = [agent.agent_name for agent in agents]
        
        return f'''"""
åŸºäºCooragentçš„å¤šæ™ºèƒ½ä½“åº”ç”¨
è‡ªåŠ¨ç”Ÿæˆäº: {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}

ç”¨æˆ·éœ€æ±‚ç”Ÿæˆçš„æ™ºèƒ½ä½“: {", ".join(agent_names)}
"""
import asyncio
import logging
from pathlib import Path
from typing import Dict, Any

from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from pydantic import BaseModel

# å¯¼å…¥Cooragentæ ¸å¿ƒç»„ä»¶
from src.workflow.process import run_agent_workflow
from src.manager import agent_manager
from src.service.server import Server
from src.utils.path_utils import get_project_root

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class TaskRequest(BaseModel):
    content: str
    user_id: str = "app_user"

class TaskResponse(BaseModel):
    status: str
    result: Dict[str, Any]
    agents_used: list[str]

# åˆ›å»ºFastAPIåº”ç”¨
app = FastAPI(
    title="å®šåˆ¶åŒ–å¤šæ™ºèƒ½ä½“åº”ç”¨",
    description="åŸºäºCooragentç”Ÿæˆçš„ä¸“ä¸šå¤šæ™ºèƒ½ä½“åä½œåº”ç”¨",
    version="1.0.0"
)

# æ·»åŠ CORSä¸­é—´ä»¶
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.on_event("startup")
async def startup_event():
    """åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–"""
    logger.info("åˆå§‹åŒ–æ™ºèƒ½ä½“ç®¡ç†å™¨...")
    await agent_manager.initialize()
    logger.info(f"åº”ç”¨å¯åŠ¨å®Œæˆï¼Œå¯ç”¨æ™ºèƒ½ä½“: {{list(agent_manager.available_agents.keys())}}")

@app.get("/")
async def root():
    """å¥åº·æ£€æŸ¥å’Œåº”ç”¨ä¿¡æ¯"""
    return {{
        "message": "å¤šæ™ºèƒ½ä½“åº”ç”¨è¿è¡Œæ­£å¸¸",
        "available_agents": list(agent_manager.available_agents.keys()),
        "custom_agents": {agent_names},
        "version": "1.0.0",
        "based_on": "Cooragent"
    }}

@app.post("/api/task", response_model=TaskResponse)
async def execute_task(request: TaskRequest):
    """æ‰§è¡Œæ™ºèƒ½ä½“ä»»åŠ¡"""
    try:
        logger.info(f"æ¥æ”¶åˆ°ä»»åŠ¡: {{request.content[:100]}}...")
        
        # ä½¿ç”¨Cooragentå·¥ä½œæµæ‰§è¡Œä»»åŠ¡
        final_state = await run_agent_workflow(
            user_id=request.user_id,
            task_type="agent_workflow",
            user_input_messages=[{{"role": "user", "content": request.content}}],
            debug=False,
            deep_thinking_mode=True,
            search_before_planning=True,
            workmode="production"  # ä½¿ç”¨Productionæ¨¡å¼è·å¾—ç¨³å®šæ€§èƒ½
        )
        
        # æå–æ‰§è¡Œç»“æœ
        result = {{
            "task": request.content,
            "final_state": final_state,
            "execution_summary": final_state.get("messages", [])[-1] if final_state.get("messages") else "ä»»åŠ¡æ‰§è¡Œå®Œæˆ"
        }}
        
        # è·å–ä½¿ç”¨çš„æ™ºèƒ½ä½“åˆ—è¡¨
        agents_used = []
        for message in final_state.get("messages", []):
            if isinstance(message, dict) and message.get("tool"):
                agents_used.append(message["tool"])
        
        return TaskResponse(
            status="success",
            result=result,
            agents_used=list(set(agents_used))
        )
        
    except Exception as e:
        logger.error(f"ä»»åŠ¡æ‰§è¡Œå¤±è´¥: {{str(e)}}")
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/agents")
async def list_agents():
    """åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ™ºèƒ½ä½“"""
    agents_info = []
    for name, agent in agent_manager.available_agents.items():
        agents_info.append({{
            "name": agent.agent_name,
            "description": agent.description,
            "llm_type": agent.llm_type,
            "tools": [tool.name for tool in agent.selected_tools],
            "user_id": agent.user_id,
            "is_custom": agent.user_id != "share"
        }})
    
    return {{"agents": agents_info}}

@app.get("/api/workflow/{{workflow_id}}")
async def get_workflow_info(workflow_id: str):
    """è·å–å·¥ä½œæµä¿¡æ¯"""
    # è¿™é‡Œå¯ä»¥æ·»åŠ å·¥ä½œæµçŠ¶æ€æŸ¥è¯¢é€»è¾‘
    return {{"workflow_id": workflow_id, "status": "completed"}}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
'''
    
    async def generate_custom_workflow_config(self, project_path: Path, config: dict):
        """ç”Ÿæˆå®šåˆ¶åŒ–å·¥ä½œæµé…ç½®"""
        workflow_config = {{
            "workflow_id": "custom_app_workflow",
            "mode": "agent_workflow", 
            "version": 1,
            "user_input_messages": [],
            "agents": []
        }}
        
        # æ·»åŠ å®šåˆ¶æ™ºèƒ½ä½“é…ç½®
        for agent in config["agents"]:
            agent_config = {{
                "agent_name": agent.agent_name,
                "description": agent.description,
                "llm_type": agent.llm_type,
                "selected_tools": [tool.name for tool in agent.selected_tools],
                "prompt": agent.prompt
            }}
            workflow_config["agents"].append(agent_config)
        
        config_dir = project_path / "config"
        config_dir.mkdir(exist_ok=True)
        
        import json
        async with aiofiles.open(config_dir / "workflow.json", "w", encoding="utf-8") as f:
            await f.write(json.dumps(workflow_config, indent=2, ensure_ascii=False))
    
    async def generate_environment_config(self, project_path: Path, config: dict):
        """ç”Ÿæˆç¯å¢ƒé…ç½®æ–‡ä»¶"""
        # ç”Ÿæˆ.env.example
        env_content = '''# ç¯å¢ƒé…ç½®æ–‡ä»¶
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º.envå¹¶å¡«å…¥å®é™…å€¼

# LLMé…ç½® (å¿…éœ€)
BASIC_API_KEY=your_openai_api_key_here
BASIC_BASE_URL=https://api.openai.com/v1
BASIC_MODEL=gpt-4

CODE_API_KEY=your_code_llm_api_key_here  
CODE_BASE_URL=https://api.deepseek.com/v1
CODE_MODEL=deepseek-chat

REASONING_API_KEY=your_reasoning_api_key_here
REASONING_BASE_URL=https://api.openai.com/v1
REASONING_MODEL=o1-preview

# å·¥å…·APIå¯†é’¥ (æ ¹æ®ä½¿ç”¨çš„å·¥å…·é…ç½®)'''

        # æ ¹æ®ä½¿ç”¨çš„å·¥å…·æ·»åŠ ç›¸åº”çš„APIé…ç½®
        if "tavily_tool" in config["tools"]:
            env_content += '''
TAVILY_API_KEY=your_tavily_api_key_here'''
        
        if "browser_tool" in config["tools"]:
            env_content += '''
# æµè§ˆå™¨å·¥å…·é…ç½®
USE_BROWSER=true'''
        
        env_content += '''

# åº”ç”¨é…ç½®
APP_HOST=0.0.0.0
APP_PORT=8000
DEBUG=false
LOG_LEVEL=INFO

# åŒ¿åé¥æµ‹ (å¯é€‰)
ANONYMIZED_TELEMETRY=false
'''
        
        async with aiofiles.open(project_path / ".env.example", "w", encoding="utf-8") as f:
            await f.write(env_content)

#### 2.2.3 é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨

```python
# src/generator/config_generator.py
class ConfigGenerator:
    """é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨"""
    
    async def generate_requirements(self, project_path: Path, agents: List[Agent]):
        """ç”Ÿæˆrequirements.txt"""
        requirements = self._get_base_requirements()
        
        # æ ¹æ®æ™ºèƒ½ä½“ä½¿ç”¨çš„å·¥å…·æ·»åŠ ä¾èµ–
        for agent in agents:
            for tool in agent.selected_tools:
                tool_deps = self._get_tool_dependencies(tool.name)
                requirements.extend(tool_deps)
        
        # å»é‡
        requirements = list(set(requirements))
        requirements.sort()
        
        content = "\\n".join(requirements)
        async with aiofiles.open(project_path / "requirements.txt", "w") as f:
            await f.write(content)
    
    def _get_base_requirements(self) -> List[str]:
        """è·å–åŸºç¡€ä¾èµ–"""
        return [
            "fastapi>=0.104.0",
            "uvicorn>=0.24.0",
            "pydantic>=2.5.0",
            "python-dotenv>=1.0.0",
            "aiofiles>=23.2.1",
            "httpx>=0.25.0",
            "python-multipart>=0.0.6"
        ]
    
    def _get_tool_dependencies(self, tool_name: str) -> List[str]:
        """æ ¹æ®å·¥å…·åç§°è·å–ä¾èµ–"""
        tool_deps = {
            "tavily_tool": ["tavily-python>=0.3.0"],
            "python_repl_tool": ["jupyter>=1.0.0"],
            "bash_tool": [],
            "crawl_tool": ["beautifulsoup4>=4.12.0", "requests>=2.31.0"],
            "browser_tool": ["playwright>=1.40.0"]
        }
        return tool_deps.get(tool_name, [])
    
    async def generate_env_example(self, project_path: Path):
        """ç”Ÿæˆ.env.example"""
        content = '''# ç¯å¢ƒé…ç½®æ–‡ä»¶ç¤ºä¾‹
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º.envå¹¶å¡«å…¥å®é™…å€¼

# LLMé…ç½®
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1

# å…¶ä»–APIå¯†é’¥
TAVILY_API_KEY=your_tavily_api_key_here
SERPER_API_KEY=your_serper_api_key_here

# åº”ç”¨é…ç½®
APP_HOST=0.0.0.0
APP_PORT=8000
DEBUG=false

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
'''
        async with aiofiles.open(project_path / ".env.example", "w") as f:
            await f.write(content)
    
    async def generate_dockerfile(self, project_path: Path):
        """ç”ŸæˆDockerfile"""
        content = '''FROM python:3.12-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \\
    curl \\
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["python", "run.py"]
'''
        async with aiofiles.open(project_path / "Dockerfile", "w") as f:
            await f.write(content)
    
    async def generate_docker_compose(self, project_path: Path):
        """ç”Ÿæˆdocker-compose.yml"""
        content = '''version: '3.8'

services:
  app:
    build: .
    ports:
      - "8000:8000"
    env_file:
      - .env
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  logs:
'''
        async with aiofiles.open(project_path / "docker-compose.yml", "w") as f:
            await f.write(content)
```

### 2.3 Webæ¥å£è®¾è®¡ (åŸºäºCooragent Server)

#### 2.3.1 æ‰©å±•ç°æœ‰APIæ¥å£

```python
# src/api/generator_api.py  
from fastapi import FastAPI, HTTPException, BackgroundTasks, Depends
from fastapi.responses import FileResponse
from pydantic import BaseModel
import asyncio
import uuid
from pathlib import Path
from datetime import datetime

# å¯¼å…¥ç°æœ‰Cooragentç»„ä»¶
from src.service.server import Server
from src.generator.cooragent_generator import CooragentProjectGenerator

class GenerateRequest(BaseModel):
    content: str
    user_id: str = None

class GenerateResponse(BaseModel):
    task_id: str
    status: str
    message: str
    created_at: datetime

class GenerationStatus(BaseModel):
    task_id: str
    status: str  # processing, completed, failed
    message: str
    progress: int = 0
    zip_path: str = None
    created_at: datetime
    completed_at: datetime = None

# æ‰©å±•ç°æœ‰Cooragent Server
class GeneratorServer(Server):
    """æ‰©å±•çš„ä»£ç ç”ŸæˆæœåŠ¡å™¨"""
    
    def __init__(self):
        super().__init__()
        self.generator = CooragentProjectGenerator()
        self.generation_tasks = {}
        
        # æ·»åŠ ä»£ç ç”Ÿæˆè·¯ç”±
        self.add_generation_routes()
    
    def add_generation_routes(self):
        """æ·»åŠ ä»£ç ç”Ÿæˆç›¸å…³è·¯ç”±"""
        
        @self.app.post("/api/generate", response_model=GenerateResponse)
        async def generate_code(request: GenerateRequest, background_tasks: BackgroundTasks):
            """ç”ŸæˆåŸºäºCooragentçš„é¡¹ç›®ä»£ç """
            task_id = str(uuid.uuid4())
            user_id = request.user_id or f"user_{task_id[:8]}"
            
            # å¯åŠ¨åå°ä»»åŠ¡
            background_tasks.add_task(self.run_code_generation, task_id, request.content, user_id)
            
            # è®°å½•ä»»åŠ¡çŠ¶æ€
            self.generation_tasks[task_id] = GenerationStatus(
                task_id=task_id,
                status="processing",
                message="æ­£åœ¨åˆ†æéœ€æ±‚å¹¶ç”Ÿæˆä»£ç ...",
                created_at=datetime.now()
            )
            
            return GenerateResponse(
                task_id=task_id,
                status="processing",
                message="ä»£ç ç”Ÿæˆå·²å¼€å§‹ï¼ŒåŸºäºCooragentæ¶æ„",
                created_at=datetime.now()
            )
        
        @self.app.get("/api/generate/{task_id}/status", response_model=GenerationStatus)
        async def get_generation_status(task_id: str):
            """è·å–ç”ŸæˆçŠ¶æ€"""
            if task_id not in self.generation_tasks:
                raise HTTPException(status_code=404, detail="ä»»åŠ¡ä¸å­˜åœ¨")
            
            return self.generation_tasks[task_id]
        
        @self.app.get("/api/generate/{task_id}/download")
        async def download_code(task_id: str):
            """ä¸‹è½½ç”Ÿæˆçš„ä»£ç """
            if task_id not in self.generation_tasks:
                raise HTTPException(status_code=404, detail="ä»»åŠ¡ä¸å­˜åœ¨")
            
            task = self.generation_tasks[task_id]
            if task.status != "completed":
                raise HTTPException(status_code=400, detail="ä»£ç è¿˜æœªç”Ÿæˆå®Œæˆ")
            
            if not task.zip_path or not Path(task.zip_path).exists():
                raise HTTPException(status_code=404, detail="ç”Ÿæˆçš„æ–‡ä»¶ä¸å­˜åœ¨")
            
            return FileResponse(
                path=task.zip_path,
                filename=f"cooragent_app_{task_id[:8]}.zip",
                media_type="application/zip"
            )
        
        @self.app.get("/api/generate/examples")
        async def get_examples():
            """è·å–éœ€æ±‚ç¤ºä¾‹"""
            examples = [
                {
                    "title": "è‚¡ç¥¨åˆ†æç³»ç»Ÿ",
                    "description": "åˆ›å»ºä¸€ä¸ªè‚¡ç¥¨åˆ†æä¸“å®¶agentï¼ŒæŸ¥çœ‹è‚¡ç¥¨èµ°åŠ¿ï¼Œåˆ†æçƒ­ç‚¹æ–°é—»ï¼Œé¢„æµ‹è‚¡ä»·å¹¶ç»™å‡ºæŠ•èµ„å»ºè®®",
                    "category": "finance"
                },
                {
                    "title": "æ–°é—»æƒ…æ„Ÿåˆ†æ",
                    "description": "æ„å»ºä¸€ä¸ªæ–°é—»åˆ†æç³»ç»Ÿï¼Œèƒ½å¤ŸæŠ“å–æ–°é—»ã€åˆ†ææƒ…æ„Ÿå¹¶ç”Ÿæˆæ‘˜è¦æŠ¥å‘Š",
                    "category": "nlp"
                },
                {
                    "title": "æ•°æ®åˆ†æå·¥å…·",
                    "description": "å¼€å‘ä¸€ä¸ªæ•°æ®åˆ†æå·¥å…·ï¼Œæ”¯æŒCSVæ–‡ä»¶å¤„ç†ã€ç»Ÿè®¡åˆ†æå’Œå›¾è¡¨ç”Ÿæˆ",
                    "category": "data"
                },
                {
                    "title": "æ™ºèƒ½å®¢æœç³»ç»Ÿ", 
                    "description": "æ„å»ºä¸€ä¸ªæ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œèƒ½å¤Ÿå›ç­”é—®é¢˜ã€æŸ¥è¯¢ä¿¡æ¯å¹¶è®°å½•å¯¹è¯å†å²",
                    "category": "chatbot"
                },
                {
                    "title": "æ—…æ¸¸è§„åˆ’åŠ©æ‰‹",
                    "description": "åˆ›å»ºä¸€ä¸ªæ—…æ¸¸è§„åˆ’ç³»ç»Ÿï¼Œçˆ¬å–æ™¯ç‚¹ä¿¡æ¯ï¼Œè§„åˆ’è¡Œç¨‹ï¼Œç”Ÿæˆæ—…æ¸¸æŠ¥å‘Š",
                    "category": "travel"
                }
            ]
            return {"examples": examples}
    
    async def run_code_generation(self, task_id: str, content: str, user_id: str):
        """è¿è¡Œä»£ç ç”Ÿæˆä»»åŠ¡"""
        try:
            task = self.generation_tasks[task_id]
            
            # æ›´æ–°çŠ¶æ€ï¼šå¼€å§‹åˆ†æéœ€æ±‚
            task.status = "processing"
            task.message = "æ­£åœ¨åˆ†æéœ€æ±‚å¹¶è°ƒç”¨Cooragentå·¥ä½œæµ..."
            task.progress = 10
            
            # è°ƒç”¨Cooragentä»£ç ç”Ÿæˆå™¨
            zip_path = await self.generator.generate_project(content, user_id)
            
            # æ›´æ–°çŠ¶æ€ï¼šç”Ÿæˆå®Œæˆ
            task.status = "completed"
            task.message = "åŸºäºCooragentçš„é¡¹ç›®ä»£ç ç”Ÿæˆå®Œæˆï¼"
            task.progress = 100
            task.zip_path = str(zip_path)
            task.completed_at = datetime.now()
            
        except Exception as e:
            # æ›´æ–°çŠ¶æ€ï¼šç”Ÿæˆå¤±è´¥
            task = self.generation_tasks[task_id]
            task.status = "failed"
            task.message = f"ç”Ÿæˆå¤±è´¥: {str(e)}"
            task.progress = 0
            logger.error(f"ä»£ç ç”Ÿæˆå¤±è´¥ {task_id}: {e}")

# åˆ›å»ºç”Ÿæˆå™¨æœåŠ¡å®ä¾‹
generator_server = GeneratorServer()
app = generator_server.app
```

#### 2.3.2 ç®€æ´çš„å‰ç«¯ç•Œé¢

```html
<!-- static/generator.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooragent ä»£ç ç”Ÿæˆå™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 700px;
            width: 90%;
            text-align: center;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
        }
        
        .input-area {
            margin: 30px 0;
        }
        
        .input-box {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        .input-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
            margin: 10px;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            display: none;
        }
        
        .status.processing {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
        }
        
        .status.completed {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        
        .status.failed {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s;
            width: 0%;
        }
        
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            margin-top: 15px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
        }
        
        .download-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .examples {
            margin-top: 30px;
            text-align: left;
        }
        
        .examples h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .example-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid #667eea;
        }
        
        .example-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .example-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .example-desc {
            font-size: 0.9em;
            color: #666;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #999;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ¤– Cooragent ä»£ç ç”Ÿæˆå™¨</h1>
            <p class="subtitle">ä¸€å¥è¯æè¿°éœ€æ±‚ï¼Œè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„å¤šæ™ºèƒ½ä½“åº”ç”¨ä»£ç </p>
            <span class="badge">åŸºäº Cooragent æ¶æ„</span>
        </div>
        
        <div class="input-area">
            <textarea 
                id="userInput" 
                class="input-box" 
                placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šåˆ›å»ºä¸€ä¸ªè‚¡ç¥¨åˆ†æç³»ç»Ÿï¼Œèƒ½å¤Ÿè·å–å®æ—¶è‚¡ç¥¨æ•°æ®ã€åˆ†ææŠ€æœ¯æŒ‡æ ‡ã€çˆ¬å–ç›¸å…³æ–°é—»å¹¶ç”ŸæˆæŠ•èµ„å»ºè®®æŠ¥å‘Š..."
            ></textarea>
        </div>
        
        <button id="generateBtn" class="generate-btn" onclick="generateCode()">
            ğŸš€ ç”Ÿæˆ Cooragent åº”ç”¨
        </button>
        
        <div id="status" class="status">
            <div id="statusMessage"></div>
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="examples">
            <h3>ğŸ’¡ éœ€æ±‚ç¤ºä¾‹:</h3>
            <div class="example-grid" id="exampleGrid">
                <!-- ç¤ºä¾‹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
        
        <div class="footer">
            <p>âœ¨ åŸºäº Cooragent å¤šæ™ºèƒ½ä½“åä½œå¹³å°æ„å»º</p>
            <p>ğŸ”§ ç”Ÿæˆçš„åº”ç”¨åŒ…å«å®Œæ•´çš„éƒ¨ç½²é…ç½®å’Œæ–‡æ¡£</p>
        </div>
    </div>

    <script>
        let currentTaskId = null;
        let examples = [];
        
        // é¡µé¢åŠ è½½æ—¶è·å–ç¤ºä¾‹
        window.onload = async function() {
            await loadExamples();
        };
        
        async function loadExamples() {
            try {
                const response = await fetch('/api/generate/examples');
                const data = await response.json();
                examples = data.examples;
                renderExamples();
            } catch (error) {
                console.error('åŠ è½½ç¤ºä¾‹å¤±è´¥:', error);
            }
        }
        
        function renderExamples() {
            const grid = document.getElementById('exampleGrid');
            grid.innerHTML = '';
            
            examples.forEach(example => {
                const item = document.createElement('div');
                item.className = 'example-item';
                item.onclick = () => setExample(example.description);
                item.innerHTML = `
                    <div class="example-title">${example.title}</div>
                    <div class="example-desc">${example.description}</div>
                `;
                grid.appendChild(item);
            });
        }
        
        function setExample(description) {
            document.getElementById('userInput').value = description;
        }
        
        async function generateCode() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥æ‚¨çš„éœ€æ±‚æè¿°');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            const status = document.getElementById('status');
            
            // ç¦ç”¨æŒ‰é’®
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>æ­£åœ¨å¯åŠ¨ Cooragent...';
            
            try {
                // å‘èµ·ç”Ÿæˆè¯·æ±‚
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: input })
                });
                
                const result = await response.json();
                currentTaskId = result.task_id;
                
                // æ˜¾ç¤ºçŠ¶æ€
                showStatus('processing', 'ğŸ”„ æ­£åœ¨è°ƒç”¨ Cooragent å·¥ä½œæµåˆ†æéœ€æ±‚...');
                
                // å¼€å§‹è½®è¯¢çŠ¶æ€
                pollStatus();
                
            } catch (error) {
                showStatus('failed', 'âŒ ç”Ÿæˆå¤±è´¥: ' + error.message);
                resetButton();
            }
        }
        
        async function pollStatus() {
            if (!currentTaskId) return;
            
            try {
                const response = await fetch(`/api/generate/${currentTaskId}/status`);
                const status = await response.json();
                
                // æ›´æ–°è¿›åº¦æ¡
                updateProgress(status.progress);
                
                if (status.status === 'completed') {
                    showStatus('completed', 
                        'âœ… åŸºäº Cooragent çš„é¡¹ç›®ä»£ç ç”Ÿæˆå®Œæˆï¼<br>' +
                        'ğŸ“¦ åŒ…å«å®Œæ•´çš„å¤šæ™ºèƒ½ä½“æ¶æ„å’Œéƒ¨ç½²é…ç½®<br>' +
                        `<a href="/api/generate/${currentTaskId}/download" class="download-btn">ğŸ“¥ ä¸‹è½½å®Œæ•´é¡¹ç›®</a>`
                    );
                    resetButton();
                } else if (status.status === 'failed') {
                    showStatus('failed', 'âŒ ç”Ÿæˆå¤±è´¥: ' + status.message);
                    resetButton();
                } else {
                    // æ›´æ–°æ¶ˆæ¯å¹¶ç»§ç»­è½®è¯¢
                    document.getElementById('statusMessage').innerHTML = status.message;
                    setTimeout(pollStatus, 2000);
                }
                
            } catch (error) {
                showStatus('failed', 'âŒ çŠ¶æ€æŸ¥è¯¢å¤±è´¥: ' + error.message);
                resetButton();
            }
        }
        
        function showStatus(type, message) {
            const status = document.getElementById('status');
            const messageEl = document.getElementById('statusMessage');
            const progressBar = document.getElementById('progressBar');
            
            status.className = 'status ' + type;
            messageEl.innerHTML = message;
            status.style.display = 'block';
            
            if (type === 'processing') {
                progressBar.style.display = 'block';
            } else {
                progressBar.style.display = 'none';
            }
        }
        
        function updateProgress(progress) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = progress + '%';
        }
        
        function resetButton() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = false;
            btn.innerHTML = 'ğŸš€ ç”Ÿæˆ Cooragent åº”ç”¨';
        }
    </script>
</body>
</html>
```

### 2.4 éƒ¨ç½²å’Œæ–‡ä»¶ç®¡ç†

#### 2.4.1 æ–‡ä»¶æ¸…ç†æœºåˆ¶

```python
# src/utils/file_cleaner.py
class FileCleanupManager:
    """æ–‡ä»¶æ¸…ç†ç®¡ç†å™¨"""
    
    def __init__(self, output_dir: Path, max_age_hours: int = 24):
        self.output_dir = output_dir
        self.max_age_hours = max_age_hours
    
    async def cleanup_old_files(self):
        """æ¸…ç†è¿‡æœŸæ–‡ä»¶"""
        if not self.output_dir.exists():
            return
        
        cutoff_time = datetime.now() - timedelta(hours=self.max_age_hours)
        cleaned_count = 0
        
        for item in self.output_dir.iterdir():
            try:
                if item.stat().st_mtime < cutoff_time.timestamp():
                    if item.is_file():
                        item.unlink()
                    elif item.is_dir():
                        shutil.rmtree(item)
                    cleaned_count += 1
            except Exception as e:
                logger.warning(f"æ¸…ç†æ–‡ä»¶å¤±è´¥ {item}: {e}")
        
        logger.info(f"æ¸…ç†äº† {cleaned_count} ä¸ªè¿‡æœŸæ–‡ä»¶/ç›®å½•")
    
    async def start_cleanup_scheduler(self):
        """å¯åŠ¨å®šæ—¶æ¸…ç†ä»»åŠ¡"""
        while True:
            await asyncio.sleep(3600)  # æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
            await self.cleanup_old_files()
```

#### 2.4.2 å‹ç¼©åŠŸèƒ½å®ç°

```python
# src/utils/compression.py
import zipfile
import os

class ProjectCompressor:
    """é¡¹ç›®å‹ç¼©å™¨"""
    
    @staticmethod
    async def compress_project(project_path: Path) -> Path:
        """å‹ç¼©é¡¹ç›®ç›®å½•"""
        zip_path = project_path.parent / f"{project_path.name}.zip"
        
        with zipfile.ZipFile(zip_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
            for root, dirs, files in os.walk(project_path):
                for file in files:
                    file_path = Path(root) / file
                    arc_path = file_path.relative_to(project_path.parent)
                    zipf.write(file_path, arc_path)
        
        # åˆ é™¤åŸç›®å½•
        shutil.rmtree(project_path)
        
        return zip_path
```

## ä¸‰ã€å®æ–½è®¡åˆ’ (åŸºäºCooragentæ¶æ„)

### 3.1 å¼€å‘é˜¶æ®µ

#### ç¬¬ä¸€é˜¶æ®µï¼šCooragenté›†æˆä¸ä»£ç ç”Ÿæˆå™¨å¼€å‘ (1å‘¨)
- [ ] å®ç°CooragentProjectGeneratoræ ¸å¿ƒç±»
- [ ] å®ŒæˆCooragentç»„ä»¶å¤åˆ¶å’Œå®šåˆ¶åŒ–é€»è¾‘
- [ ] é›†æˆç°æœ‰çš„src/workflow/process.pyå·¥ä½œæµç³»ç»Ÿ
- [ ] å®ç°åŸºäºæ™ºèƒ½ä½“é…ç½®çš„é¡¹ç›®æ–‡ä»¶ç”Ÿæˆ
- [ ] æµ‹è¯•ä¸ç°æœ‰agent_managerçš„é›†æˆ

#### ç¬¬äºŒé˜¶æ®µï¼šWebæ¥å£æ‰©å±•å¼€å‘ (3-4å¤©)
- [ ] æ‰©å±•ç°æœ‰çš„src/service/server.py Serverç±»
- [ ] å®ç°GeneratorServerå’Œä»£ç ç”ŸæˆAPIè·¯ç”±
- [ ] å¼€å‘åŸºäºCooragentçš„å‰ç«¯ç•Œé¢
- [ ] å®Œæˆæ–‡ä»¶å‹ç¼©å’Œä¸‹è½½åŠŸèƒ½
- [ ] æ·»åŠ ä»»åŠ¡çŠ¶æ€ç®¡ç†å’Œå®æ—¶è½®è¯¢

#### ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå–„å’Œä¼˜åŒ– (2-3å¤©)
- [ ] å®ç°æ–‡ä»¶æ¸…ç†æœºåˆ¶å’Œç£ç›˜ç®¡ç†
- [ ] ä¼˜åŒ–Cooragentç»„ä»¶é€‰æ‹©é€»è¾‘
- [ ] å®Œå–„ç”Ÿæˆé¡¹ç›®çš„é…ç½®æ–‡ä»¶æ¨¡æ¿
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œfallbackæœºåˆ¶
- [ ] ä¼˜åŒ–ç”¨æˆ·ç•Œé¢ä½“éªŒå’Œç¤ºä¾‹

#### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•å’Œéƒ¨ç½² (1-2å¤©)
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•ï¼ˆéœ€æ±‚â†’Cooragentå·¥ä½œæµâ†’é¡¹ç›®ç”Ÿæˆâ†’éƒ¨ç½²ï¼‰
- [ ] ç”Ÿæˆé¡¹ç›®çš„ç‹¬ç«‹è¿è¡Œæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç¨³å®šæ€§æµ‹è¯•
- [ ] Dockeréƒ¨ç½²é…ç½®å’Œä½¿ç”¨æ–‡æ¡£

### 3.2 æŠ€æœ¯é£é™©å’Œè§£å†³æ–¹æ¡ˆ

#### é£é™©1ï¼šCooragentå·¥ä½œæµé›†æˆå¤æ‚åº¦
**è§£å†³æ–¹æ¡ˆ**: 
- ç›´æ¥å¤ç”¨ç°æœ‰çš„run_agent_workflowå‡½æ•°
- ä½¿ç”¨Launchæ¨¡å¼è¿›è¡Œéœ€æ±‚åˆ†æå’Œæ™ºèƒ½ä½“ç”Ÿæˆ
- åŸºäºagent_managerè·å–å·²ç”Ÿæˆçš„æ™ºèƒ½ä½“é…ç½®
- æ·»åŠ å·¥ä½œæµè¶…æ—¶å’Œé”™è¯¯é‡è¯•æœºåˆ¶

#### é£é™©2ï¼šç»„ä»¶å¤åˆ¶å’Œä¾èµ–ç®¡ç†
**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»ºç»„ä»¶æ˜ å°„è¡¨ï¼Œç²¾ç¡®æ§åˆ¶å¤åˆ¶çš„æ–‡ä»¶
- è‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»å’Œimportè·¯å¾„
- ç”Ÿæˆrequirements.txtæ—¶æ ¹æ®å®é™…ä½¿ç”¨çš„å·¥å…·åŠ¨æ€æ·»åŠ ä¾èµ–
- æä¾›ç»„ä»¶å®Œæ•´æ€§éªŒè¯æœºåˆ¶

#### é£é™©3ï¼šç”Ÿæˆé¡¹ç›®çš„è¿è¡Œç¨³å®šæ€§
**è§£å†³æ–¹æ¡ˆ**:
- åŸºäºå·²éªŒè¯çš„Cooragentæ ¸å¿ƒä»£ç ï¼Œç¡®ä¿ç¨³å®šæ€§
- ç”Ÿæˆçš„é¡¹ç›®åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ
- æä¾›è¯¦ç»†çš„READMEå’Œéƒ¨ç½²è¯´æ˜
- å†…ç½®å¥åº·æ£€æŸ¥å’Œç›‘æ§ç«¯ç‚¹

#### é£é™©4ï¼šæ–‡ä»¶ç®¡ç†å’Œèµ„æºæ§åˆ¶
**è§£å†³æ–¹æ¡ˆ**:
- å®ç°å®šæ—¶æ¸…ç†æœºåˆ¶ï¼Œè‡ªåŠ¨åˆ é™¤è¿‡æœŸé¡¹ç›®
- è®¾ç½®å•ä¸ªé¡¹ç›®å¤§å°é™åˆ¶ï¼ˆå¦‚50MBï¼‰
- é™åˆ¶å¹¶å‘ç”Ÿæˆä»»åŠ¡æ•°é‡
- æ·»åŠ ç£ç›˜ç©ºé—´ç›‘æ§å’Œå‘Šè­¦

### 3.3 éƒ¨ç½²æ–¹æ¡ˆ

#### å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
# åœ¨ç°æœ‰Cooragenté¡¹ç›®ä¸­æ·»åŠ ç”Ÿæˆå™¨åŠŸèƒ½
cd cooragent

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœ‰æ–°å¢ï¼‰
uv sync

# å¯åŠ¨æ‰©å±•çš„æœåŠ¡å™¨ï¼ˆåŒ…å«ä»£ç ç”ŸæˆåŠŸèƒ½ï¼‰
uv run python -m src.api.generator_api --port 8000

# æˆ–è€…ä½¿ç”¨ç°æœ‰å¯åŠ¨æ–¹å¼
uv run python cli.py
# ç„¶åè®¿é—® http://localhost:8000/generator.html
```

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```yaml
# docker-compose.yml (æ‰©å±•ç°æœ‰é…ç½®)
version: '3.8'
services:
  cooragent-generator:
    build: .
    ports:
      - "8000:8000"
    environment:
      # CooragentåŸºç¡€ç¯å¢ƒå˜é‡
      - BASIC_API_KEY=${BASIC_API_KEY}
      - BASIC_BASE_URL=${BASIC_BASE_URL}
      - BASIC_MODEL=${BASIC_MODEL}
      - CODE_API_KEY=${CODE_API_KEY}
      - REASONING_API_KEY=${REASONING_API_KEY}
      - TAVILY_API_KEY=${TAVILY_API_KEY}
      
      # ä»£ç ç”Ÿæˆå™¨ç‰¹å®šé…ç½®
      - OUTPUT_DIR=/app/generated_projects
      - CLEANUP_HOURS=24
      - MAX_CONCURRENT_GENERATIONS=5
      - MAX_PROJECT_SIZE_MB=50
    volumes:
      - ./generated_projects:/app/generated_projects
      - ./store:/app/store  # å¤ç”¨ç°æœ‰çš„æ™ºèƒ½ä½“å­˜å‚¨
      - ./.env:/app/.env
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  generated_projects:
```

#### é›†æˆç°æœ‰ç³»ç»Ÿ
```bash
# å°†ä»£ç ç”Ÿæˆå™¨ä½œä¸ºCooragentçš„æ‰©å±•æ¨¡å—
# åœ¨ç°æœ‰çš„src/service/server.pyä¸­æ·»åŠ ç”Ÿæˆå™¨è·¯ç”±

# 1. æ‰©å±•ç°æœ‰Serverç±»
# 2. æ·»åŠ é™æ€æ–‡ä»¶æœåŠ¡æ”¯æŒå‰ç«¯ç•Œé¢
# 3. ä¿æŒä¸ç°æœ‰APIçš„å…¼å®¹æ€§
```

### 3.4 è´¨é‡ä¿è¯

#### è‡ªåŠ¨åŒ–æµ‹è¯•
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•CooragentProjectGeneratorå„ä¸ªæ–¹æ³•
- **é›†æˆæµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„ç”Ÿæˆæµç¨‹ï¼ˆéœ€æ±‚â†’ç”Ÿæˆâ†’éƒ¨ç½²ï¼‰
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•ç”Ÿæˆé¡¹ç›®çš„ç‹¬ç«‹è¿è¡Œèƒ½åŠ›

#### ç”Ÿæˆé¡¹ç›®éªŒè¯
- **ä»£ç è¯­æ³•æ£€æŸ¥**: ç¡®ä¿ç”Ÿæˆçš„Pythonä»£ç è¯­æ³•æ­£ç¡®
- **ä¾èµ–å®Œæ•´æ€§**: éªŒè¯requirements.txtåŒ…å«æ‰€æœ‰å¿…éœ€ä¾èµ–
- **Dockeræ„å»ºæµ‹è¯•**: ç¡®ä¿ç”Ÿæˆçš„é¡¹ç›®å¯ä»¥æˆåŠŸæ„å»ºå’Œè¿è¡Œ
- **APIå“åº”æµ‹è¯•**: éªŒè¯ç”Ÿæˆçš„åº”ç”¨APIåŠŸèƒ½æ­£å¸¸

#### æ€§èƒ½åŸºå‡†
- **ç”Ÿæˆæ—¶é—´**: ç›®æ ‡30-60ç§’å®Œæˆé¡¹ç›®ç”Ÿæˆ
- **é¡¹ç›®å¤§å°**: å‹ç¼©åŒ…é€šå¸¸åœ¨5-15MBèŒƒå›´
- **å¹¶å‘èƒ½åŠ›**: æ”¯æŒè‡³å°‘5ä¸ªç”¨æˆ·åŒæ—¶ç”Ÿæˆ
- **èµ„æºä½¿ç”¨**: å•æ¬¡ç”Ÿæˆå†…å­˜ä½¿ç”¨ä¸è¶…è¿‡500MB

## å››ã€é¢„æœŸæˆæœ (åŸºäºCooragent)

### 4.1 ç”¨æˆ·ä½“éªŒ
- **é›¶å­¦ä¹ æˆæœ¬**: ç”¨æˆ·æ— éœ€äº†è§£Cooragentæ¶æ„ç»†èŠ‚
- **ä¸“ä¸šè´¨é‡**: ç”Ÿæˆçš„é¡¹ç›®åŸºäºæˆç†Ÿçš„Cooragentæ¶æ„
- **å³æ—¶å¯ç”¨**: ä¸‹è½½åç›´æ¥å¯ä»¥éƒ¨ç½²è¿è¡Œ
- **å®Œæ•´ç”Ÿæ€**: ç”Ÿæˆçš„é¡¹ç›®ç»§æ‰¿Cooragentçš„å·¥å…·å’Œæ‰©å±•èƒ½åŠ›

### 4.2 ç”Ÿæˆçš„é¡¹ç›®ç‰¹ç‚¹
- **æ¶æ„æˆç†Ÿ**: åŸºäºå·²éªŒè¯çš„Cooragentå¤šæ™ºèƒ½ä½“æ¶æ„
- **åŠŸèƒ½å®Œæ•´**: åŒ…å«å·¥ä½œæµå¼•æ“ã€æ™ºèƒ½ä½“ç®¡ç†ã€LLMé›†æˆç­‰æ ¸å¿ƒåŠŸèƒ½
- **æ˜“äºæ‰©å±•**: ä¿æŒä¸Cooragentç”Ÿæ€çš„å…¼å®¹æ€§ï¼Œæ”¯æŒåç»­æ‰©å±•
- **éƒ¨ç½²å°±ç»ª**: åŒ…å«Dockeré…ç½®ã€ç¯å¢ƒå˜é‡æ¨¡æ¿ã€å¯åŠ¨è„šæœ¬ç­‰

### 4.3 æŠ€æœ¯æŒ‡æ ‡
- **ä»£ç å¤ç”¨ç‡**: 80%+ ä»£ç æ¥è‡ªCooragentæ ¸å¿ƒç»„ä»¶
- **ç”ŸæˆæˆåŠŸç‡**: 95%+ ï¼ˆåŸºäºæˆç†Ÿç»„ä»¶çš„ç¨³å®šæ€§ï¼‰
- **é¡¹ç›®å¯è¿è¡Œç‡**: 98%+ ï¼ˆå®Œæ•´çš„ä¾èµ–å’Œé…ç½®ç®¡ç†ï¼‰
- **ç”¨æˆ·æ»¡æ„åº¦**: ç›®æ ‡90%+ ï¼ˆåŸºäºä¸“ä¸šæ¶æ„çš„é«˜è´¨é‡è¾“å‡ºï¼‰

### 4.4 å•†ä¸šä»·å€¼
- **é™ä½é—¨æ§›**: å°†Cooragentä»å¼€å‘æ¡†æ¶å‡çº§ä¸ºåº”ç”¨ç”Ÿæˆå™¨
- **æ‰©å¤§ç”¨æˆ·ç¾¤**: å¸å¼•ä¸ç†Ÿæ‚‰å¤šæ™ºèƒ½ä½“å¼€å‘çš„ç”¨æˆ·
- **ç”Ÿæ€å»ºè®¾**: ç”Ÿæˆçš„é¡¹ç›®å¤©ç„¶é›†æˆCooragentç”Ÿæ€ç³»ç»Ÿ
- **äº§å“å·®å¼‚åŒ–**: æä¾›"ä¸€å¥è¯ç”Ÿæˆä¸“ä¸šå¤šæ™ºèƒ½ä½“åº”ç”¨"çš„ç‹¬ç‰¹ä»·å€¼

è¿™ä¸ªåŸºäºCooragentæ¶æ„çš„æœ€å°åŸå‹å°†å¤§å¤§é™ä½å¤šæ™ºèƒ½ä½“åº”ç”¨å¼€å‘çš„é—¨æ§›ï¼ŒåŒæ—¶ä¿æŒä¸“ä¸šæ°´å‡†å’ŒæŠ€æœ¯å…ˆè¿›æ€§ï¼ 